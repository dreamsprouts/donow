# èªè­‰ç³»çµ±æ•´åˆè¨ˆåŠƒ

## å°ˆæ¡ˆèƒŒæ™¯

æˆ‘å€‘å·²ç¶“å®Œæˆäº† DoNow å°ˆæ¡ˆçš„èº«ä»½é©—è­‰ç³»çµ±æ¸¬è©¦ï¼ŒåŒ…å«æœ¬åœ°å¸³è™Ÿè¨»å†Š/ç™»å…¥å’Œ Google OAuth ç™»å…¥åŠŸèƒ½ã€‚ç¾åœ¨éœ€è¦å°‡é€™äº›åŠŸèƒ½å¾æ¸¬è©¦ç’°å¢ƒ (`/api/auth-test/*`) æ•´åˆåˆ°æ­£å¼ç’°å¢ƒ (`/api/auth/*`)ã€‚

æœ¬æ–‡æª”è©³ç´°è¨˜éŒ„æ•´åˆæ­¥é©Ÿï¼Œä»¥ç¢ºä¿æ‰€æœ‰é–‹ç™¼äººå“¡éƒ½èƒ½æ¸…æ¥šç†è§£æµç¨‹ï¼Œä¸¦åœ¨äº¤æ¥æ™‚ç„¡ç¸«éŠœæ¥ã€‚

## æ•´é«”ç›®æ¨™

1. å°‡æ¸¬è©¦ç’°å¢ƒçš„èªè­‰åŠŸèƒ½é·ç§»åˆ°æ­£å¼ç’°å¢ƒ
2. å¢å¼·å®‰å…¨æ€§å’Œç”¨æˆ¶é«”é©—
3. ç¢ºä¿æ‰€æœ‰æ•¸æ“šé—œè¯ç¬¦åˆç”Ÿç”¢è¦æ±‚
4. ç„¡ç¸«éæ¸¡ï¼Œä¸å½±éŸ¿ç¾æœ‰ç”¨æˆ¶

## ä¸€ã€å¾Œç«¯æ•´åˆ

### 1.1 è·¯ç”±é·ç§» âœ…

å°‡æ¸¬è©¦è·¯ç”±å¾ `/api/auth-test/` é·ç§»åˆ°æ­£å¼è·¯ç”± `/api/auth/`

#### æ­¥é©Ÿï¼š

1. âœ… æª¢æŸ¥ `backend/routes/auth.js` æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
   - æ–‡ä»¶å·²å­˜åœ¨ï¼Œèˆ‡ `authTest.js` çµæ§‹ç›¸ä¼¼ä½†è·¯å¾‘å·²æ›´æ–°

2. âœ… åœ¨ `server.js` ä¸­è¨»å†Šæ–°è·¯ç”±ï¼š
   ```javascript
   app.use('/api/auth', require('./routes/auth'));
   ```
   - å·²ç¢ºèªè·¯ç”±å·²è¨»å†Š

3. âœ… æš«æ™‚ä¿ç•™æ¸¬è©¦è·¯ç”±ï¼Œä»¥ä¾¿æ–¼æ¸¬è©¦å’Œé€æ­¥éæ¸¡
   ```javascript
   // åªåœ¨éç”Ÿç”¢ç’°å¢ƒå•Ÿç”¨æ¸¬è©¦è·¯ç”±
   if (process.env.NODE_ENV !== 'production') {
     app.use('/api/auth-test', require('./routes/authTest'));
     console.log(`${new Date().toISOString()} å·²å•Ÿç”¨èªè­‰æ¸¬è©¦è·¯ç”± /api/auth-test`);
   }
   ```

#### é©—è­‰æ–¹æ³•ï¼š
- ä½¿ç”¨ Postman æ¸¬è©¦æ–°çš„ API ç«¯é»
- ç¢ºä¿æ‰€æœ‰åŠŸèƒ½ï¼ˆè¨»å†Šã€ç™»å…¥ã€ç²å–ç”¨æˆ¶è³‡æ–™ç­‰ï¼‰æ­£å¸¸å·¥ä½œ

### 1.2 æ›´æ–° Passport é…ç½® âœ…

ä¿®æ”¹ Google OAuth å›èª¿ URL å’Œå…¶ä»–ç›¸é—œé…ç½®

#### æ­¥é©Ÿï¼š

1. âœ… æ›´æ–° `config/passport.js` ä¸­çš„å›èª¿ URLï¼š
   ```javascript
   // æª¢æ¸¬ç’°å¢ƒï¼Œæ±ºå®šä½¿ç”¨å“ªå€‹å›èª¿ URL
   const getCallbackURL = () => {
     // åœ¨éç”Ÿç”¢ç’°å¢ƒåŒæ™‚æ”¯æŒæ¸¬è©¦å’Œæ­£å¼è·¯ç”±
     if (process.env.NODE_ENV !== 'production') {
       // å¾æŸ¥è©¢åƒæ•¸æˆ–ç’°å¢ƒè®Šé‡ä¸­ç²å–ç›®æ¨™è·¯ç”±é¡å‹
       const targetRoute = process.env.OAUTH_TARGET_ROUTE || 'auth';
       return `/api/${targetRoute}/google/callback`;
     }
     
     // ç”Ÿç”¢ç’°å¢ƒåªä½¿ç”¨æ­£å¼è·¯ç”±
     return '/api/auth/google/callback';
   };
   
   passport.use(
     new GoogleStrategy(
       {
         clientID: process.env.GOOGLE_CLIENT_ID,
         clientSecret: process.env.GOOGLE_CLIENT_SECRET,
         callbackURL: getCallbackURL(),
         proxy: true
       },
       // ...
     )
   );
   ```

2. âœ… ç‚ºç”Ÿç”¢ç’°å¢ƒæ·»åŠ  Google OAuth è¨­ç½®ï¼š
   - åœ¨ `backend/.env` ä¸­æ·»åŠ  OAUTH_TARGET_ROUTE ç’°å¢ƒè®Šé‡ï¼ˆå¯é¸ï¼‰

### 1.3 å®‰å…¨æ€§å¢å¼· âœ…

æå‡ JWT å’Œå…¶ä»–å®‰å…¨æ©Ÿåˆ¶çš„å¥å£¯æ€§

#### æ­¥é©Ÿï¼š

1. âœ… å¢å¼· JWT é…ç½®ï¼š
   ```javascript
   const token = jwt.sign(
     { id: user._id },
     process.env.JWT_SECRET || 'secret-key',
     { 
       expiresIn: '7d',  // å¢åŠ æœ‰æ•ˆæœŸï¼Œå¾1å°æ™‚åˆ°7å¤©
       algorithm: 'HS256' // æ˜ç¢ºæŒ‡å®šç®—æ³•
     }
   );
   ```

2. âœ… å¢å¼· Cookie å®‰å…¨æ€§ï¼š
   ```javascript
   res.cookie('accessToken', token, {
     httpOnly: true,
     secure: process.env.NODE_ENV === 'production',
     maxAge: 7 * 24 * 60 * 60 * 1000, // 7å¤©
     sameSite: 'lax' // é˜²æ­¢CSRFæ”»æ“Š
   });
   ```

3. â³ ç¢ºä¿ä½¿ç”¨ HTTPSï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰ï¼š
   - åœ¨ç”Ÿç”¢éƒ¨ç½²æ™‚é…ç½® HTTPS

## äºŒã€å‰ç«¯æ•´åˆ

### 2.0 è·¯ç”±æ¶æ§‹æ±ºç­– âœ…

ç¶“è©•ä¼°ï¼Œç•¶å‰æ‡‰ç”¨ä½¿ç”¨å–®é é¢ç‹€æ…‹ç®¡ç†è€ŒéReact Routerã€‚ç‚ºå¿«é€Ÿä¸Šç·šç”¨æˆ¶åŠŸèƒ½ï¼Œæ±ºå®šæ¡ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

#### æ±ºç­–ï¼š

1. âœ… ä¸å¼•å…¥React Routerï¼Œè€Œæ˜¯èª¿æ•´èªè­‰çµ„ä»¶ä»¥é©æ‡‰ç¾æœ‰ç„¡è·¯ç”±æ¶æ§‹ï¼š
   - å„ªé»ï¼šæ”¹å‹•ç¯„åœå°ï¼Œå¯¦æ–½é€Ÿåº¦å¿«ï¼Œä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½
   - ç¼ºé»ï¼šé•·æœŸä¾†çœ‹å¯èƒ½é™åˆ¶æ“´å±•æ€§
   
2. âœ… å…·é«”å¯¦æ–½æ–¹å¼ï¼š
   - ç§»é™¤èªè­‰çµ„ä»¶ä¸­çš„Routerç›¸é—œä»£ç¢¼ï¼ˆå¦‚useNavigateå’ŒLinkï¼‰
   - ä½¿ç”¨ç‹€æ…‹ç®¡ç†æ§åˆ¶èªè­‰é é¢çš„é¡¯ç¤º/éš±è—
   - å°‡ç™»å…¥/è¨»å†Šè¨­è¨ˆç‚ºæ¨¡æ…‹æ¡†æˆ–å…§åµŒé é¢çµ„ä»¶

3. â³ æœªä¾†è¨ˆåŠƒï¼š
   - åœ¨åŸºæœ¬åŠŸèƒ½ç©©å®šå¾Œï¼Œè¦åŠƒå®Œæ•´çš„è·¯ç”±é‡æ§‹
   - æé«˜æ‡‰ç”¨æ¶æ§‹çš„å¯æ“´å±•æ€§å’Œç¶­è­·æ€§

#### å‚™è¨»ï¼š
- æ­¤æ±ºç­–é è¨ˆå¯ç¯€çœ1-2å¤©çš„é–‹ç™¼æ™‚é–“
- å¾ŒçºŒå¯è¦åŠƒè·¯ç”±æ¶æ§‹é‡æ§‹ï¼Œä½œç‚ºæŠ€è¡“å‚µå‹™ç®¡ç†çš„ä¸€éƒ¨åˆ†

### 2.1 å‰µå»ºæ­£å¼ç™»å…¥çµ„ä»¶ âœ…

åŸºæ–¼ç¾æœ‰çµ„ä»¶å‰µå»ºç²¾ç°¡ç‰ˆçš„ç”Ÿç”¢ç”¨çµ„ä»¶

#### æ­¥é©Ÿï¼š

1. âœ… å·²å®Œæˆ Auth çµ„ä»¶å’Œ AuthContext çš„å‰µå»º
   ```
   frontend/src/components/Auth/Auth.jsx
   frontend/src/components/Auth/AuthContext.jsx
   ```

2. âœ… å·²å®Œæˆä½¿ç”¨ useAuth hook åœ¨ App.js ä¸­ç²å–ç”¨æˆ¶ç‹€æ…‹

### 2.2 æ›´æ–° API ç«¯é» âœ…

å°‡æ‰€æœ‰å‰ç«¯ API èª¿ç”¨å¾æ¸¬è©¦ç«¯é»æ›´æ–°åˆ°æ­£å¼ç«¯é»

### 2.3 æ•´åˆç¾æœ‰ä»»å‹™å’Œè¨ˆæ™‚å™¨åŠŸèƒ½ âœ…

**åŸæœ‰æ•´åˆæ–¹æ³•å­˜åœ¨å•é¡Œï¼Œç¾å·²æ¡ç”¨æ›´åˆé©çš„æ–¹å¼æˆåŠŸæ•´åˆ**

#### æ•´åˆæ–¹å¼ï¼š

1. âœ… å·²æ¡ç”¨æ¨¡æ…‹æ¡†è¨­è¨ˆæ•´åˆ Auth çµ„ä»¶ï¼š
   ```javascript
   // åœ¨ App.js ä¸­æ·»åŠ èªè­‰ç›¸é—œç‹€æ…‹ç®¡ç†
   const { currentUser, logout } = useAuth();
   const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);
   
   const handleAuthModalOpen = () => setIsAuthModalOpen(true);
   const handleAuthModalClose = () => setIsAuthModalOpen(false);
   ```

2. âœ… å·²åœ¨ AppBar ä¸­æ·»åŠ ç™»å…¥/ç™»å‡ºæŒ‰éˆ•ï¼š
   ```javascript
   {/* ç”¨æˆ¶èªè­‰æŒ‰éˆ• */}
   {currentUser ? (
     <Button 
       variant="outlined"
       color="primary"
       size="small"
       onClick={logout}
       endIcon={<LogoutIcon />}
       sx={{ mr: 1 }}
     >
       {currentUser.name || 'ç”¨æˆ¶'} ç™»å‡º
     </Button>
   ) : (
     <Button 
       variant="contained"
       color="primary"
       size="small"
       onClick={handleAuthModalOpen}
       startIcon={<PersonIcon />}
       sx={{ mr: 1 }}
     >
       ç™»å…¥
     </Button>
   )}
   ```

3. âœ… å·²åœ¨é é¢åº•éƒ¨æ·»åŠ  Auth æ¨¡æ…‹æ¡†ï¼š
   ```javascript
   {/* èº«ä»½é©—è­‰æ¨¡æ…‹æ¡† */}
   <Auth open={isAuthModalOpen} onClose={handleAuthModalClose} />
   ```

## ä¸‰ã€æ•¸æ“šé—œè¯æ›´æ–°

### 3.1 ç¢ºä¿ç”¨æˆ¶æ•¸æ“šé—œè¯

ç¢ºä¿æ‰€æœ‰è³‡æºï¼ˆä»»å‹™ã€å°ˆæ¡ˆã€è¡Œå‹•è¨˜éŒ„ï¼‰æ­£ç¢ºé—œè¯åˆ°ç”¨æˆ¶

#### æ­¥é©Ÿï¼š

1. âœ… æ›´æ–°æ‰€æœ‰æ¨¡å‹æ·»åŠ ç”¨æˆ¶IDé—œè¯ï¼š
   ```javascript
   // æ·»åŠ åˆ°æ‰€æœ‰æ¨¡å‹ä¸­çš„ç”¨æˆ¶IDé—œè¯
   userId: {
     type: mongoose.Schema.Types.ObjectId,
     ref: 'User',
     required: true
   }
   ```

2. âœ… å‰µå»ºæ•¸æ“šé·ç§»è…³æœ¬ï¼š
   ```javascript
   // é·ç§»è…³æœ¬å°‡æ‰€æœ‰ç¾æœ‰æ•¸æ“šé—œè¯åˆ°æŒ‡å®šç”¨æˆ¶
   const TARGET_USER_ID = '67f7734458c5c418c589126d';
   
   // é·ç§»æˆåŠŸï¼Œå…±è™•ç†ï¼š
   // - é …ç›®: 2 å€‹
   // - ä»»å‹™: 12 å€‹
   // - è¡Œå‹•: 52 å€‹
   ```

3. âœ… å¯¦ç¾é€šç”¨çš„æ¬Šé™æª¢æŸ¥ä¸­é–“ä»¶ï¼š
   ```javascript
   const checkOwnership = (model, idParam = 'id', ownerField = 'userId') => {
     return async (req, res, next) => {
       // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦ç‚ºè³‡æºæ“æœ‰è€…
       const ownerId = resource[ownerField];
       const userId = req.user.id;
       
       if (!ownerId || ownerId.toString() !== userId) {
         return res.status(403).json({ 
           success: false,
           message: 'æ‚¨ç„¡æ¬Šè¨ªå•æ­¤è³‡æº' 
         });
       }
       
       next();
     };
   };
   ```

4. âœ… æ›´æ–°æ‰€æœ‰å¾Œç«¯è·¯ç”±æ·»åŠ æ¬Šé™æª¢æŸ¥ï¼š
   - âœ… æ›´æ–° projects.js æ·»åŠ æ¬Šé™æª¢æŸ¥
   - âœ… æ›´æ–° tasks.js æ·»åŠ æ¬Šé™æª¢æŸ¥
   - âœ… æ›´æ–° timer.js æ·»åŠ æ¬Šé™æª¢æŸ¥

5. ğŸ”„ æ›´æ–°å‰ç«¯ API æœå‹™æ·»åŠ æˆæ¬Šé ­éƒ¨ï¼š
   ```javascript
   // ç²å–æˆæ¬Šé ­éƒ¨
   const getAuthHeaders = () => {
     const token = localStorage.getItem('token');
     const headers = {
       'Content-Type': 'application/json'
     };
     
     if (token) {
       headers['Authorization'] = `Bearer ${token}`;
     }
     
     return headers;
   };
   
   // åœ¨æ‰€æœ‰ API è«‹æ±‚ä¸­ä½¿ç”¨
   const response = await fetch(url, {
     headers: getAuthHeaders(),
     credentials: 'include'
   });
   ```

### 3.2 æ•¸æ“šé·ç§»çµæœ

æ•¸æ“šé·ç§»å·²æˆåŠŸå®Œæˆï¼Œæ‰€æœ‰ç¾æœ‰æ•¸æ“šç¾åœ¨éƒ½èˆ‡æŒ‡å®šçš„ç”¨æˆ¶é—œè¯ï¼š

| æ•¸æ“šé¡å‹ | é·ç§»æ•¸é‡ | ç‹€æ…‹ |
|---------|----------|------|
| é …ç›® (Project) | 2 | âœ… å·²å®Œæˆ |
| ä»»å‹™ (Task) | 12 | âœ… å·²å®Œæˆ |
| è¡Œå‹•è¨˜éŒ„ (Action) | 52 | âœ… å·²å®Œæˆ |
| ç¸½è¨ˆ | 66 | âœ… å·²å®Œæˆ |

## å››ã€ç’°å¢ƒé…ç½®èˆ‡éƒ¨ç½²

### 4.1 ç’°å¢ƒè®Šé‡é…ç½® âœ…

å®Œå–„ `.env` æ–‡ä»¶é…ç½®

#### æ­¥é©Ÿï¼š

1. âœ… æª¢æŸ¥ä¸¦æ›´æ–° `backend/.env` æ–‡ä»¶ï¼Œç¢ºä¿åŒ…å«èªè­‰ç›¸é—œé…ç½®ï¼š
   ```
   # æ‡‰ç”¨ç¨‹å¼è¨­å®š
   PORT=5001
   
   # è³‡æ–™åº«é€£ç·š
   MONGODB_URI=mongodb://localhost:27017/pomodoro
   
   # Google Authentication
   GOOGLE_CLIENT_ID=19939650154-9po4sejv9ehfeah0vun4ohdb9gvjsr4l.apps.googleusercontent.com
   GOOGLE_CLIENT_SECRET=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

   # JWT è¨­å®š
   JWT_SECRET=your-jwt-secret
   
   # å‰ç«¯ URL
   FRONTEND_URL=http://localhost:3000
   
   # ç’°å¢ƒè¨­å®š (development/production)
   NODE_ENV=development
   
   # OAuth è·¯ç”±é¡å‹ (auth/auth-test)
   OAUTH_TARGET_ROUTE=auth
   ```

2. âœ… åœ¨ `.gitignore` ä¸­ç¢ºä¿ `.env` æ–‡ä»¶è¢«å¿½ç•¥

3. âœ… å‰µå»º `.env.example` æ¨¡æ¿æ–‡ä»¶ä¾›åœ˜éšŠåƒè€ƒ

### 4.2 éƒ¨ç½²è¨ˆåŠƒ

å®‰æ’æœ‰åºçš„éƒ¨ç½²æ­¥é©Ÿ

#### æ­¥é©Ÿï¼š

1. éƒ¨ç½²å¾Œç«¯æ›´æ–°ï¼š
   - å…ˆéƒ¨ç½²æ–°è·¯ç”±ï¼Œä¿æŒèˆŠè·¯ç”±å¯ç”¨
   - æ¸¬è©¦æ–° API ç«¯é»çš„åŠŸèƒ½

2. éƒ¨ç½²å‰ç«¯æ›´æ–°ï¼š
   - å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒéƒ¨ç½²ä¸¦æ¸¬è©¦
   - ç¢ºèªæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å¾Œå†éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

3. ç›£æ§èˆ‡å›æ»¾è¨ˆåŠƒï¼š
   - è¨­ç½®éŒ¯èª¤ç›£æ§
   - æº–å‚™å›æ»¾è…³æœ¬ï¼Œä»¥å‚™ä¸æ™‚ä¹‹éœ€

## äº”ã€æ¸¬è©¦èˆ‡é©—è­‰

### 5.1 æ¸¬è©¦è¨ˆåŠƒ

å…¨é¢æ¸¬è©¦æ•´åˆå¾Œçš„ç³»çµ±

#### æ­¥é©Ÿï¼š

1. å–®å…ƒæ¸¬è©¦ï¼š
   - æ¸¬è©¦å€‹åˆ¥ API ç«¯é»
   - æ¸¬è©¦èªè­‰é‚è¼¯

2. é›†æˆæ¸¬è©¦ï¼š
   - æ¸¬è©¦å®Œæ•´ç™»å…¥æµç¨‹
   - æ¸¬è©¦ Google OAuth æµç¨‹
   - æ¸¬è©¦ç”¨æˆ¶æ¬Šé™å’Œæ•¸æ“šé—œè¯

3. è·¨ç€è¦½å™¨å’Œè¨­å‚™æ¸¬è©¦ï¼š
   - ç¢ºä¿åœ¨ä¸»æµç€è¦½å™¨ä¸­åŠŸèƒ½æ­£å¸¸
   - æ¸¬è©¦éŸ¿æ‡‰å¼è¨­è¨ˆå’Œç§»å‹•è¨­å‚™å…¼å®¹æ€§

### 5.2 é©—æ”¶æ¨™æº–

é …ç›®é€šéçš„æ¢ä»¶

#### æ¨™æº–ï¼š

1. æ‰€æœ‰èªè­‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. æ‰€æœ‰ç”¨æˆ¶æ•¸æ“šæ­£ç¢ºé—œè¯
3. æ–°èˆŠç³»çµ±éæ¸¡æœŸç„¡ç”¨æˆ¶å ±å‘Šå•é¡Œ
4. å®‰å…¨å¯©è¨ˆç„¡é‡å¤§é¢¨éšªç™¼ç¾

## å…­ã€å¯¦æ–½æ™‚é–“è¡¨

æ•´é«”å·¥ä½œè¨ˆåŠƒå’Œæ™‚é–“è¡¨

| éšæ®µ | å·¥ä½œå…§å®¹ | æ™‚é–“ä¼°è¨ˆ | è² è²¬äºº | ç‹€æ…‹ |
|-----|---------|---------|-------|------|
| 1 | å¾Œç«¯è·¯ç”±é·ç§» | 2 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 2 | Passport é…ç½®æ›´æ–° | 1 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 3 | å®‰å…¨æ€§å¢å¼· | 2 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 4 | å‰ç«¯çµ„ä»¶é–‹ç™¼ | 3 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 5 | API ç«¯é»æ›´æ–° | 2 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 6 | æ•¸æ“šé—œè¯æ›´æ–° | 2 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 7 | ç’°å¢ƒé…ç½® | 1 å¤© | å¾…å®š | âœ… å·²å®Œæˆ |
| 8 | å‰ç«¯ API æœå‹™æ›´æ–° | 1 å¤© | å¾…å®š | ğŸ”„ é€²è¡Œä¸­ |
| 9 | æ¸¬è©¦èˆ‡ä¿®å¾© | 3 å¤© | å¾…å®š | ğŸ”„ é€²è¡Œä¸­ |
| 10 | éƒ¨ç½²èˆ‡ç›£æ§ | 2 å¤© | å¾…å®š | æœªé–‹å§‹ |

é è¨ˆç¸½å·¥æœŸï¼šç´„ **2-3 é€±**

## ä¸ƒã€æ³¨æ„äº‹é …èˆ‡é¢¨éšª

éœ€è¦ç‰¹åˆ¥é—œæ³¨çš„å•é¡Œå’Œæ½›åœ¨é¢¨éšª

### æ½›åœ¨é¢¨éšªï¼š

1. **æ•¸æ“šæå¤±**ï¼šåœ¨é·ç§»éç¨‹ä¸­å¯èƒ½ä¸Ÿå¤±ç”¨æˆ¶æ•¸æ“š
   - ç·©è§£ï¼šé€²è¡Œå…¨é¢å‚™ä»½ï¼Œå¯¦æ–½åˆ†éšæ®µé·ç§»

2. **ç”¨æˆ¶é«”é©—ä¸­æ–·**ï¼šèªè­‰æ©Ÿåˆ¶è®Šæ›´å¯èƒ½å°è‡´ç”¨æˆ¶éœ€è¦é‡æ–°ç™»å…¥
   - ç·©è§£ï¼šåœ¨éæ¸¡æœŸä¿æŒé›™ç³»çµ±å…¼å®¹ï¼Œæå‰é€šçŸ¥ç”¨æˆ¶

3. **å®‰å…¨æ¼æ´**ï¼šèªè­‰ç³»çµ±è®Šæ›´å¯èƒ½å¼•å…¥æ–°æ¼æ´
   - ç·©è§£ï¼šé€²è¡Œå…¨é¢å®‰å…¨å¯©è¨ˆï¼Œå¯¦æ–½æ¼¸é€²å¼ç™¼å¸ƒ

4. **ç¬¬ä¸‰æ–¹ä¾è³´**ï¼šGoogle OAuth é…ç½®è®Šæ›´å¯èƒ½å—å¤–éƒ¨å› ç´ å½±éŸ¿
   - ç·©è§£ï¼šé€²è¡Œå……åˆ†æ¸¬è©¦ï¼Œå‡†å‚™æ‡‰æ€¥æ–¹æ¡ˆ

5. **å‰ç«¯æ•´åˆè¡çª**ï¼šèªè­‰çµ„ä»¶èˆ‡ç¾æœ‰çµ„ä»¶çµæ§‹ä¸å…¼å®¹
   - ç·©è§£ï¼šæ¡ç”¨æ¨¡æ…‹æ¡†è¨­è¨ˆï¼Œå°‡èªè­‰é‚è¼¯èˆ‡ç¾æœ‰åŠŸèƒ½è§£è€¦

## å…«ã€ç¶­è­·å’Œå¾ŒçºŒè¨ˆåŠƒ

æ•´åˆå®Œæˆå¾Œçš„ç¶­è­·å·¥ä½œ

### å¾ŒçºŒå·¥ä½œï¼š

1. **ç›£æ§å’Œæ—¥èªŒ**ï¼šè¨­ç½®èªè­‰ç³»çµ±çš„å°ˆé–€ç›£æ§
2. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæª¢æŸ¥ä¸¦æ›´æ–°èªè­‰ç›¸é—œä¾è³´
3. **ç”¨æˆ¶åé¥‹**ï¼šæ”¶é›†ç”¨æˆ¶å°ç™»å…¥é«”é©—çš„åé¥‹ä¸¦è¿­ä»£æ”¹é€²
4. **æ“´å±•è¨ˆåŠƒ**ï¼šè€ƒæ…®æ·»åŠ å…¶ä»–èªè­‰æ–¹å¼ï¼ˆå¦‚ Facebook, Apple ç™»å…¥ï¼‰

---

## åŸ·è¡Œç‹€æ…‹è¿½è¹¤

| å·¥ä½œé …ç›® | ç‹€æ…‹ | å®Œæˆæ—¥æœŸ | è² è²¬äºº | å‚™è¨» |
|---------|------|---------|-------|------|
| å‰µå»ºæ•´åˆæ–‡æª” | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬ |
| å¾Œç«¯è·¯ç”±é·ç§» | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | è·¯ç”±å·²å­˜åœ¨ |
| Passport é…ç½®æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ·»åŠ  getCallbackURL å‡½æ•¸ |
| JWT å®‰å…¨æ€§å¢å¼· | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åœ¨ auth.js ä¸­å¢å¼· JWT é…ç½® |
| ç’°å¢ƒé…ç½® | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æª¢æŸ¥ä¸¦ç¢ºèªç’°å¢ƒé…ç½® |
| å‰ç«¯çµ„ä»¶é–‹ç™¼ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»º Auth.jsx å’Œ AuthContext.jsx |
| API ç«¯é»æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–°æ‰€æœ‰APIèª¿ç”¨ç‚ºæ­£å¼ç«¯é» |
| å‰ç«¯çµ„ä»¶æ•´åˆ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ¡ç”¨æ¨¡æ…‹æ¡†è¨­è¨ˆæˆåŠŸæ•´åˆåˆ°App.js |
| UIè¨­è¨ˆèª¿æ•´ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | èª¿æ•´æŒ‰éˆ•æ¨£å¼èˆ‡ä½ç½®ï¼Œç¢ºä¿èˆ‡ç¾æœ‰UIä¸€è‡´ |
| æ¸¬è©¦æœ¬åœ°ç™»å…¥ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æœ¬åœ°å¸³è™Ÿè¨»å†Šå’Œç™»å…¥åŠŸèƒ½å·²æ¸¬è©¦é€šé |
| æ¸¬è©¦Google OAuth | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Googleç™»å…¥æµç¨‹æ¸¬è©¦é€šé |
| æ¨¡å‹æ·»åŠ ç”¨æˆ¶é—œè¯ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Projectã€Taskã€Action æ¨¡å‹æ·»åŠ  userId å­—æ®µ |
| æ•¸æ“šé·ç§»å¯¦ç¾ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºä¸¦åŸ·è¡Œé·ç§»è…³æœ¬ï¼ŒæˆåŠŸé—œè¯ 66 æ¢è¨˜éŒ„ |
| æ¬Šé™æª¢æŸ¥ä¸­é–“ä»¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºé€šç”¨ checkOwnership ä¸­é–“ä»¶ |
| å¾Œç«¯è·¯ç”±æ¬Šé™æ§åˆ¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–° projectsã€tasksã€timer è·¯ç”±æ·»åŠ æ¬Šé™æª¢æŸ¥ |
| å‰ç«¯æœå‹™æˆæ¬Šæ›´æ–° | ğŸ”„ é€²è¡Œä¸­ | - | AI åŠ©æ‰‹ | å·²æ›´æ–° taskService.jsï¼Œå…¶ä»–æœå‹™å¾…æ›´æ–° |
| ... | ... | ... | ... | ... |

## ä¹ã€é©—è­‰å•é¡Œæ’é™¤ç´€éŒ„

åœ¨å‰å¾Œç«¯æ•´åˆéç¨‹ä¸­é‡åˆ°çš„ä¸»è¦å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆï¼š

### 9.1 å‰ç«¯æ¨¡æ…‹æ¡†ç‹€æ…‹ä¿ç•™å•é¡Œ

**å•é¡Œ**ï¼šæœ¬åœ°å¸³æˆ¶ç™»å…¥ç™»å‡ºå¾Œï¼Œå†æ¬¡é»æ“Šç™»å…¥ç•«é¢æ™‚ï¼Œå‰ä¸€æ¬¡çš„ã€Œç™»å…¥æˆåŠŸã€æç¤ºä»ç„¶é¡¯ç¤ºã€‚è¨»å†ŠæˆåŠŸå¾Œä¹Ÿæœ‰é¡ä¼¼å•é¡Œã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨æ¨¡æ…‹æ¡†æ‰“é–‹æ™‚é‡ç½®æ‰€æœ‰ç‹€æ…‹
useEffect(() => {
  if (open) {
    setMessage('');
    setEmail('');
    setPassword('');
    setName('');
    setFormErrors({
      email: '',
      password: '',
      name: ''
    });
  }
}, [open]);
```

### 9.2 Google OAuth èªè­‰å•é¡Œ

**å•é¡Œ**ï¼šGoogle ç™»å…¥å¤±æ•—ï¼Œå‰ç«¯ç²å–åˆ° token ä½†ä½¿ç”¨æ™‚è¿”å› 401 Unauthorized éŒ¯èª¤ã€‚

**åŸå› **ï¼š
- JWT é©—è­‰å¯†é‘°ä¸ä¸€è‡´
- ç¼ºå°‘å¿…è¦çš„ç’°å¢ƒè®Šé‡é…ç½®

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ·»åŠ å’Œçµ±ä¸€ JWT å¯†é‘°ï¼š
```
# åœ¨ .env ä¸­æ·»åŠ 
JWT_SECRET=donow-jwt-secret-key-2024
```

2. å„ªåŒ– auth ä¸­é–“ä»¶ï¼Œæ·»åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
// ç²å– JWT å¯†é‘°
const jwtSecret = process.env.JWT_SECRET || 'donow-jwt-secret-key-2024';
console.log('ä½¿ç”¨ JWT å¯†é‘°:', jwtSecret.substring(0, 5) + '...');

// é©—è­‰token
const decoded = jwt.verify(token, jwtSecret);
```

3. ç¢ºä¿æ­£ç¢ºè¨­ç½® FRONTEND_URL å’Œ OAUTH_TARGET_ROUTEï¼š
```
# å‰ç«¯ URL
FRONTEND_URL=http://localhost:3000

# OAuth è·¯ç”±è¨­å®š
OAUTH_TARGET_ROUTE=auth
```

### 9.3 Cookie èˆ‡ Authorization Header è™•ç†

**å•é¡Œ**ï¼šå‰ç«¯ç™¼é€çš„ Authorization é ­éƒ¨æœªæ­£ç¢ºå‚³éæˆ–è™•ç†ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ AuthContext ä¸­æ·»åŠ æ›´è©³ç´°çš„æ—¥èªŒè¼¸å‡º
2. åœ¨å¾Œç«¯ auth ä¸­é–“ä»¶ä¸­æ·»åŠ è«‹æ±‚å’Œé ­éƒ¨åˆ†ææ—¥èªŒ
3. ç¢ºä¿ CORS è¨­ç½®æ­£ç¢ºæ”¯æŒ credentials

### 9.4 éŒ¯èª¤è™•ç†æ”¹é€²

**å•é¡Œ**ï¼šéŒ¯èª¤è¨Šæ¯ä¸å¤ è©³ç´°ï¼Œé›£ä»¥è¨ºæ–·å•é¡Œæ‰€åœ¨ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ auth ä¸­é–“ä»¶ä¸­å¢åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
console.log('èªè­‰ä¸­é–“ä»¶è™•ç†è«‹æ±‚è·¯å¾‘:', req.path);
console.log('Authorization é ­éƒ¨:', req.headers.authorization);
console.log('Cookie ä¸­çš„ token:', req.cookies.accessToken);
console.log('ä½¿ç”¨çš„ token:', token ? token.substring(0, 15) + '...' : 'null');
```

2. åœ¨éŒ¯èª¤éŸ¿æ‡‰ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼š
```javascript
return res.status(401).json({ 
  success: false, 
  message: 'ç„¡æ•ˆçš„æˆæ¬Š',
  error: error.message
});
```

## åã€å¾ŒçºŒå·¥ä½œé …ç›®

- [x] å¯¦ç¾ç”¨æˆ¶è³‡æ–™èˆ‡ä»»å‹™/å°ˆæ¡ˆçš„æ•¸æ“šé—œè¯
- [x] ç¢ºä¿ç”¨æˆ¶åªèƒ½è¨ªå•è‡ªå·±çš„è³‡æºï¼ˆæ¬Šé™æ§åˆ¶ï¼‰
- [x] æ›´æ–°æ‰€æœ‰å‰ç«¯ API æœå‹™æ·»åŠ æˆæ¬Šé ­éƒ¨
  - [x] å·²æ›´æ–° App.js ä¸­çš„æ‰€æœ‰ API è«‹æ±‚
  - [x] å·²æ›´æ–° taskService.js æœå‹™
  - [x] å·²æ›´æ–° projectService.js æœå‹™ 
  - [x] å·²æ›´æ–° reportService.js æœå‹™
  - [x] å·²å®Œæˆæ‰€æœ‰ API create/update/delete æ“ä½œçš„æˆæ¬Šæª¢æŸ¥
- [x] æ¸¬è©¦æ‰€æœ‰ç”¨æˆ¶é—œè¯åŠŸèƒ½
  - [x] å·²æ¸¬è©¦ç™»å…¥/ç™»å‡ºåŠŸèƒ½
  - [x] å·²å®Œå–„ç™»å‡ºæ™‚çš„æ•¸æ“šæ¸…ç†åŠŸèƒ½
  - [x] å·²æ¸¬è©¦ç”¨æˆ¶æ¬Šé™æ§åˆ¶
- [ ] æ·»åŠ ç”¨æˆ¶å€‹äººè¨­å®šé é¢
- [ ] å„ªåŒ–ç™»å…¥é é¢çš„ä½¿ç”¨é«”é©—
- [ ] è€ƒæ…®å¢åŠ å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥é¸é …ï¼ˆå¦‚ Facebook, Appleï¼‰

## åä¸€ã€ç”¨æˆ¶ç•Œé¢å±•ç¤º

### 11.1 ç™»å…¥æŒ‰éˆ•èˆ‡ç”¨æˆ¶ç‹€æ…‹å±•ç¤º

æ‡‰ç”¨é ‚éƒ¨å°èˆªæ¬„ä¸­çš„ç™»å…¥/ç™»å‡ºæŒ‰éˆ•è¨­è¨ˆï¼š

```jsx
{/* ç”¨æˆ¶èªè­‰æŒ‰éˆ• */}
{currentUser ? (
  <Button 
    variant="outlined"
    color="primary"
    size="small"
    onClick={logout}
    endIcon={<LogoutIcon />}
    sx={{ mr: 1 }}
  >
    {currentUser.name || 'ç”¨æˆ¶'} ç™»å‡º
  </Button>
) : (
  <Button 
    variant="contained"
    color="primary"
    size="small"
    onClick={handleAuthModalOpen}
    startIcon={<PersonIcon />}
    sx={{ mr: 1 }}
  >
    ç™»å…¥
  </Button>
)}
```

### 11.2 ç™»å…¥/è¨»å†Šæ¨¡æ…‹æ¡†

ç™»å…¥/è¨»å†Šæ¨¡æ…‹æ¡†è¨­è¨ˆï¼Œæ”¯æŒæœ¬åœ°å¸³è™Ÿå’Œ Google ç™»å…¥ï¼š

- æœ¬åœ°å¸³è™Ÿæ”¯æŒè¡¨å–®é©—è­‰
- æ”¯æŒåœ¨ç™»å…¥/è¨»å†Šæ¨¡å¼é–“åˆ‡æ›
- Google ç™»å…¥æ”¯æŒä½¿ç”¨ OAuth 2.0 èªè­‰

ç™»å…¥æˆåŠŸå¾Œï¼Œæ¨¡æ…‹æ¡†è‡ªå‹•é—œé–‰ï¼Œç”¨æˆ¶ç‹€æ…‹è¢«æ›´æ–°ï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•ã€‚

### 11.3 èº«ä»½é©—è­‰æ•¸æ“šæµ

1. ç”¨æˆ¶é»æ“Šã€Œç™»å…¥ã€æŒ‰éˆ•ï¼Œæ‰“é–‹ç™»å…¥æ¨¡æ…‹æ¡†
2. ç”¨æˆ¶é¸æ“‡ç™»å…¥æ–¹å¼ï¼ˆæœ¬åœ°å¸³è™Ÿæˆ– Googleï¼‰
3. ç™»å…¥æˆåŠŸå¾Œï¼Œå¾Œç«¯ç”Ÿæˆ JWT ä»¤ç‰Œ
4. å‰ç«¯å°‡ä»¤ç‰Œä¿å­˜åˆ° localStorage
5. ä½¿ç”¨è©²ä»¤ç‰Œç™¼èµ· `/api/auth/me` è«‹æ±‚ç²å–ç”¨æˆ¶è³‡æ–™
6. æˆåŠŸå¾Œï¼Œæ›´æ–° UI é¡¯ç¤ºç”¨æˆ¶ä¿¡æ¯å’Œç™»å‡ºæŒ‰éˆ•
7. ç”¨æˆ¶é»æ“Šã€Œç™»å‡ºã€æŒ‰éˆ•ï¼Œæ¸…é™¤ localStorage ä¸­çš„ä»¤ç‰Œ
8. UI æ›´æ–°ç‚ºæœªç™»å…¥ç‹€æ…‹ 

## åäºŒã€å‰ç«¯ API æ•´åˆçµ±ä¸€æ¨¡å¼

ç‚ºç¢ºä¿æ•´åˆéç¨‹ä¸€è‡´ä¸”é¢¨éšªæœ€å°ï¼Œæˆ‘å€‘æ¡ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š

### 12.1 æˆæ¬Šé ­éƒ¨è™•ç†æ–¹å¼

åœ¨ App.js ä¸­ï¼Œæˆ‘å€‘å·²ç¶“å¯¦ç¾äº† getAuthHeaders å‡½æ•¸ä¾†ç²å–æˆæ¬Šé ­éƒ¨ï¼š

```javascript
// ç²å–æˆæ¬Šé ­éƒ¨
const getAuthHeaders = () => {
  const token = localStorage.getItem('token');
  const headers = {
    'Content-Type': 'application/json'
  };
  
  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }
  
  return headers;
};
```

æ‰€æœ‰ API è«‹æ±‚æ‡‰ä½¿ç”¨é€™ç¨®æ¨¡å¼æ·»åŠ æˆæ¬Šé ­éƒ¨ï¼š

```javascript
const response = await fetch(`${API_URL}/api/endpoint`, {
  method: 'GET', // æˆ– 'POST', 'PUT', 'DELETE' ç­‰
  headers: getAuthHeaders(),
  credentials: 'include',
  body: JSON.stringify(data) // å¦‚æœéœ€è¦
});
```

### 12.2 å¯¦æ–½æ­¥é©Ÿ

å°æ–¼æ¯å€‹æœå‹™æ–‡ä»¶ï¼ˆå¦‚ taskService.js, projectService.js ç­‰ï¼‰ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ·»åŠ æˆæ¬Šï¼š

1. åœ¨æœå‹™æ–‡ä»¶é ‚éƒ¨æ·»åŠ  getAuthHeaders å‡½æ•¸ï¼š
   ```javascript
   const getAuthHeaders = () => {
     const token = localStorage.getItem('token');
     const headers = {
       'Content-Type': 'application/json'
     };
     
     if (token) {
       headers['Authorization'] = `Bearer ${token}`;
     }
     
     return headers;
   };
   ```

2. æ›´æ–°æ‰€æœ‰ API è«‹æ±‚ï¼Œæ·»åŠ æˆæ¬Šé ­éƒ¨å’Œ credentialsï¼š
   ```javascript
   const response = await fetch(url, {
     headers: getAuthHeaders(),
     credentials: 'include'
   });
   ```

æ­¤æ–¹æ³•çš„å„ªé»ï¼š
- ä¿æŒèˆ‡ç¾æœ‰ä»£ç¢¼ä¸€è‡´
- ä¸å¼•å…¥æ–°çš„ä¾è³´æˆ–æ¶æ§‹æ›´æ”¹
- æ¯å€‹æ–‡ä»¶ç¨ç«‹ï¼Œæ¸›å°‘å¼•ç”¨éŒ¯èª¤é¢¨éšª
- ä¿®æ”¹ç¯„åœæœ€å°ï¼Œé™ä½å‡ºéŒ¯æ©Ÿç‡

### 12.3 é•·æœŸè¨ˆåŠƒ

æœªä¾†é‡æ§‹æ™‚ï¼Œå¯ä»¥è€ƒæ…®ä»¥ä¸‹æ–¹æ¡ˆï¼š
- å°‡ getAuthHeaders é·ç§»è‡³ä¸­å¤®æˆæ¬Šæœå‹™
- ä½¿ç”¨è«‹æ±‚æ””æˆªå™¨ï¼ˆå¦‚ä½¿ç”¨ Axiosï¼‰
- æ•´åˆè‡³çµ±ä¸€çš„ç‹€æ…‹ç®¡ç†ï¼ˆå¦‚ Reduxï¼‰

ä½†ç›®å‰éšæ®µï¼Œæˆ‘å€‘å„ªå…ˆè€ƒæ…®ç©©å®šæ€§å’Œä¸€è‡´æ€§ï¼Œéµå¾ªç¾æœ‰æ¨¡å¼é€²è¡Œæ¼¸é€²å¼æ•´åˆã€‚ 

## åä¸‰ã€ç™»å‡ºæ•¸æ“šæ¸…ç†å¯¦ç¾

ç‚ºè§£æ±ºç”¨æˆ¶ç™»å‡ºå¾Œæ•¸æ“šä»ç„¶é¡¯ç¤ºçš„å•é¡Œï¼Œæˆ‘å€‘å¯¦ç¾äº†çµ±ä¸€çš„æ•¸æ“šæ¸…ç†æ©Ÿåˆ¶ã€‚è©²æ©Ÿåˆ¶ç¢ºä¿ç•¶ç”¨æˆ¶ç™»å‡ºæ™‚ï¼Œæ‰€æœ‰çµ„ä»¶ä¸­çš„æ•¸æ“šéƒ½è¢«æ¸…ç©ºã€‚

### 13.1 å¯¦ç¾æ–¹å¼

æˆ‘å€‘æ¡ç”¨äº†æœ€å°å¹²æ“¾åŸå‰‡ï¼Œç‚ºæ¯å€‹çµ„ä»¶æ·»åŠ äº†å° `currentUser` ç‹€æ…‹çš„ç›£è½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¤‡é›œçš„äº‹ä»¶ç³»çµ±ã€‚ç•¶ `currentUser` è®Šç‚º null æ™‚ï¼Œå„çµ„ä»¶è‡ªè¡Œæ¸…ç†è‡ªå·±çš„æ•¸æ“šç‹€æ…‹ã€‚

### 13.2 å·²å®Œæˆçµ„ä»¶æ›´æ–°

ä»¥ä¸‹çµ„ä»¶å·²ç¶“å¯¦ç¾äº†ç™»å‡ºæ•¸æ“šæ¸…ç†ï¼š

1. **App.js**
   - æ¸…ç†è¨ˆæ™‚å™¨æ•¸æ“šå’Œæ­·å²è¨˜éŒ„
   - ç•¶è¨ˆæ™‚å™¨æ­£åœ¨é‹è¡Œæ™‚ï¼Œæœƒå…ˆçµæŸè¨ˆæ™‚å™¨å†æ¸…ç†æ•¸æ“š

2. **ProjectManager.js**
   - æ¸…ç†å°ˆæ¡ˆåˆ—è¡¨
   - æ¸…ç†å°ˆæ¡ˆçµ±è¨ˆæ•¸æ“š
   - æ¸…ç†é¸ä¸­çš„å°ˆæ¡ˆ

3. **TaskManager.js**
   - æ¸…ç†ä»»å‹™åˆ—è¡¨
   - æ¸…ç†ä»»å‹™ç·¨è¼¯å™¨ç‹€æ…‹

4. **HabitMode.js**
   - æ¸…ç†ç¿’æ…£ä»»å‹™åˆ—è¡¨
   - æ¸…ç†ç¿’æ…£è¨˜éŒ„
   - æ¸…ç†é¸ä¸­çš„ç¿’æ…£ä»»å‹™

5. **TaskSelector.js**
   - æ¸…ç†ä»»å‹™ä¸‹æ‹‰åˆ—è¡¨
   - æ¸…ç†è¼¸å…¥å’ŒéŒ¯èª¤ç‹€æ…‹
   
6. **ProjectActionList.js**
   - æ¸…ç†å°ˆæ¡ˆç›¸é—œçš„è¡Œå‹•è¨˜éŒ„
   - æ·»åŠ ç”¨æˆ¶èªè­‰æª¢æŸ¥ï¼Œæœªç™»å…¥æ™‚ä¸é¡¯ç¤ºå…§å®¹

### 13.3 é›£é»åŠè§£æ±ºæ–¹æ¡ˆ

1. **æ™‚é–“çµ±è¨ˆé é¢å•é¡Œ**
   - å•é¡Œï¼šæ™‚é–“çµ±è¨ˆé é¢åœ¨ç™»å‡ºå¾Œä»é¡¯ç¤ºæ•¸æ“š
   - åŸå› ï¼šTabPanel åˆ‡æ›æ™‚çš„æ•¸æ“šç²å–æ²’æœ‰è€ƒæ…®ç”¨æˆ¶ç™»å‡ºæƒ…æ³
   - è§£æ±ºæ–¹æ¡ˆï¼š
     - ä¿®æ”¹ useEffect æ·»åŠ å° currentUser çš„æª¢æŸ¥
     - åœ¨ renderStatsContent å‡½æ•¸æ·»åŠ æœªç™»å…¥æç¤º
     - åœ¨ ProjectActionList çµ„ä»¶å¢åŠ å°ç”¨æˆ¶èªè­‰çš„æª¢æŸ¥

2. **æˆæ¬Šé ­éƒ¨å•é¡Œ**
   - å•é¡Œï¼šéƒ¨åˆ† API è«‹æ±‚æ²’æœ‰æ·»åŠ æˆæ¬Šé ­éƒ¨
   - è§£æ±ºæ–¹æ¡ˆï¼š
     - çµ±ä¸€ä½¿ç”¨ getAuthHeaders å‡½æ•¸ç²å–æˆæ¬Šé ­éƒ¨
     - ç¢ºä¿æ‰€æœ‰è«‹æ±‚éƒ½åŒ…å« credentials: 'include'

### 13.4 æ¸¬è©¦çµæœ

æ‰€æœ‰çµ„ä»¶ç¾åœ¨éƒ½èƒ½æ­£ç¢ºè™•ç†ç”¨æˆ¶ç™»å‡ºæƒ…æ³ï¼š
- ç™»å‡ºå¾Œç«‹å³æ¸…ç©ºæ•¸æ“šï¼Œä¸å†é¡¯ç¤ºå‰ä¸€å€‹ç”¨æˆ¶çš„æ•¸æ“š
- çµ„ä»¶åœ¨é¡¯ç¤ºå‰æœƒæª¢æŸ¥ç”¨æˆ¶ç™»å…¥ç‹€æ…‹
- æœªç™»å…¥æ™‚é¡¯ç¤ºé©ç•¶çš„æç¤ºæˆ–ä¸é¡¯ç¤ºæ•æ„Ÿå…§å®¹

### 13.5 å¾ŒçºŒå·¥ä½œ

éœ€è¦å®Œæˆçš„ç™»å…¥/æˆæ¬Šç›¸é—œå·¥ä½œï¼š
1. æª¢æŸ¥æ‰€æœ‰ create/update æ“ä½œæ˜¯å¦å·²æ·»åŠ æˆæ¬Šé ­éƒ¨
2. å„ªåŒ–ç”¨æˆ¶é«”é©—ï¼Œæ·»åŠ åˆé©çš„éŒ¯èª¤è™•ç†å’Œæç¤º
3. è€ƒæ…®å¯¦ç¾è¨˜ä½ç™»å…¥ç‹€æ…‹åŠŸèƒ½

## åå››ã€ç”¨æˆ¶å€‹äººè¨­å®šé é¢

### 14.1 å¯¦ç¾æ–¹å¼

åœ¨ç”¨æˆ¶å€‹äººè¨­å®šé é¢ä¸­ï¼Œç”¨æˆ¶å¯ä»¥ä¿®æ”¹å€‹äººè³‡æ–™ï¼Œå¦‚åå­—ã€é›»å­éƒµä»¶ç­‰ã€‚

### 14.2 å„ªåŒ–é«”é©—

1. åœ¨ä¿®æ”¹è³‡æ–™å¾Œï¼Œç«‹å³é¡¯ç¤ºæ›´æ–°å¾Œçš„è³‡æ–™
2. æ·»åŠ è³‡æ–™é©—è­‰ï¼Œç¢ºä¿è¼¸å…¥çš„æœ‰æ•ˆæ€§
3. åœ¨ä¿å­˜æ™‚é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º

## åäº”ã€å„ªåŒ–ç™»å…¥é é¢

### 15.1 å¯¦ç¾æ–¹å¼

åœ¨ç™»å…¥é é¢ä¸­ï¼Œç”¨æˆ¶å¯ä»¥é¸æ“‡ä¸åŒçš„ç™»å…¥æ–¹å¼ï¼Œå¦‚æœ¬åœ°å¸³è™Ÿã€Google ç™»å…¥ç­‰ã€‚

### 15.2 å„ªåŒ–é«”é©—

1. åœ¨é¸æ“‡ç™»å…¥æ–¹å¼å¾Œï¼Œç«‹å³é¡¯ç¤ºç›¸æ‡‰çš„ç™»å…¥è¡¨å–®
2. åœ¨ç™»å…¥éç¨‹ä¸­é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º
3. åœ¨ç™»å…¥æˆåŠŸå¾Œï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•

## åå…­ã€è€ƒæ…®å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥

### 16.1 å¯¦ç¾æ–¹å¼

åœ¨ç™»å…¥é é¢ä¸­æ·»åŠ å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥é¸é …ï¼Œå¦‚ Facebook, Apple ç­‰ã€‚

### 16.2 å„ªåŒ–é«”é©—

1. åœ¨é¸æ“‡ç¬¬ä¸‰æ–¹ç™»å…¥å¾Œï¼Œç«‹å³é¡¯ç¤ºç›¸æ‡‰çš„ç™»å…¥è¡¨å–®
2. åœ¨ç™»å…¥éç¨‹ä¸­é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º
3. åœ¨ç™»å…¥æˆåŠŸå¾Œï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•

## åä¸ƒã€ç¸½çµ

æ•´åˆå®Œæˆå¾Œçš„ç¶­è­·å·¥ä½œ

### å¾ŒçºŒå·¥ä½œï¼š

1. **ç›£æ§å’Œæ—¥èªŒ**ï¼šè¨­ç½®èªè­‰ç³»çµ±çš„å°ˆé–€ç›£æ§
2. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæª¢æŸ¥ä¸¦æ›´æ–°èªè­‰ç›¸é—œä¾è³´
3. **ç”¨æˆ¶åé¥‹**ï¼šæ”¶é›†ç”¨æˆ¶å°ç™»å…¥é«”é©—çš„åé¥‹ä¸¦è¿­ä»£æ”¹é€²
4. **æ“´å±•è¨ˆåŠƒ**ï¼šè€ƒæ…®æ·»åŠ å…¶ä»–èªè­‰æ–¹å¼ï¼ˆå¦‚ Facebook, Apple ç™»å…¥ï¼‰

---

## åŸ·è¡Œç‹€æ…‹è¿½è¹¤

| å·¥ä½œé …ç›® | ç‹€æ…‹ | å®Œæˆæ—¥æœŸ | è² è²¬äºº | å‚™è¨» |
|---------|------|---------|-------|------|
| å‰µå»ºæ•´åˆæ–‡æª” | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬ |
| å¾Œç«¯è·¯ç”±é·ç§» | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | è·¯ç”±å·²å­˜åœ¨ |
| Passport é…ç½®æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ·»åŠ  getCallbackURL å‡½æ•¸ |
| JWT å®‰å…¨æ€§å¢å¼· | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åœ¨ auth.js ä¸­å¢å¼· JWT é…ç½® |
| ç’°å¢ƒé…ç½® | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æª¢æŸ¥ä¸¦ç¢ºèªç’°å¢ƒé…ç½® |
| å‰ç«¯çµ„ä»¶é–‹ç™¼ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»º Auth.jsx å’Œ AuthContext.jsx |
| API ç«¯é»æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–°æ‰€æœ‰APIèª¿ç”¨ç‚ºæ­£å¼ç«¯é» |
| å‰ç«¯çµ„ä»¶æ•´åˆ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ¡ç”¨æ¨¡æ…‹æ¡†è¨­è¨ˆæˆåŠŸæ•´åˆåˆ°App.js |
| UIè¨­è¨ˆèª¿æ•´ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | èª¿æ•´æŒ‰éˆ•æ¨£å¼èˆ‡ä½ç½®ï¼Œç¢ºä¿èˆ‡ç¾æœ‰UIä¸€è‡´ |
| æ¸¬è©¦æœ¬åœ°ç™»å…¥ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æœ¬åœ°å¸³è™Ÿè¨»å†Šå’Œç™»å…¥åŠŸèƒ½å·²æ¸¬è©¦é€šé |
| æ¸¬è©¦Google OAuth | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Googleç™»å…¥æµç¨‹æ¸¬è©¦é€šé |
| æ¨¡å‹æ·»åŠ ç”¨æˆ¶é—œè¯ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Projectã€Taskã€Action æ¨¡å‹æ·»åŠ  userId å­—æ®µ |
| æ•¸æ“šé·ç§»å¯¦ç¾ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºä¸¦åŸ·è¡Œé·ç§»è…³æœ¬ï¼ŒæˆåŠŸé—œè¯ 66 æ¢è¨˜éŒ„ |
| æ¬Šé™æª¢æŸ¥ä¸­é–“ä»¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºé€šç”¨ checkOwnership ä¸­é–“ä»¶ |
| å¾Œç«¯è·¯ç”±æ¬Šé™æ§åˆ¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–° projectsã€tasksã€timer è·¯ç”±æ·»åŠ æ¬Šé™æª¢æŸ¥ |
| å‰ç«¯æœå‹™æˆæ¬Šæ›´æ–° | ğŸ”„ é€²è¡Œä¸­ | - | AI åŠ©æ‰‹ | å·²æ›´æ–° taskService.jsï¼Œå…¶ä»–æœå‹™å¾…æ›´æ–° |
| ... | ... | ... | ... | ... |

## åä¹ã€é©—è­‰å•é¡Œæ’é™¤ç´€éŒ„

åœ¨å‰å¾Œç«¯æ•´åˆéç¨‹ä¸­é‡åˆ°çš„ä¸»è¦å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆï¼š

### 19.1 å‰ç«¯æ¨¡æ…‹æ¡†ç‹€æ…‹ä¿ç•™å•é¡Œ

**å•é¡Œ**ï¼šæœ¬åœ°å¸³æˆ¶ç™»å…¥ç™»å‡ºå¾Œï¼Œå†æ¬¡é»æ“Šç™»å…¥ç•«é¢æ™‚ï¼Œå‰ä¸€æ¬¡çš„ã€Œç™»å…¥æˆåŠŸã€æç¤ºä»ç„¶é¡¯ç¤ºã€‚è¨»å†ŠæˆåŠŸå¾Œä¹Ÿæœ‰é¡ä¼¼å•é¡Œã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨æ¨¡æ…‹æ¡†æ‰“é–‹æ™‚é‡ç½®æ‰€æœ‰ç‹€æ…‹
useEffect(() => {
  if (open) {
    setMessage('');
    setEmail('');
    setPassword('');
    setName('');
    setFormErrors({
      email: '',
      password: '',
      name: ''
    });
  }
}, [open]);
```

### 19.2 Google OAuth èªè­‰å•é¡Œ

**å•é¡Œ**ï¼šGoogle ç™»å…¥å¤±æ•—ï¼Œå‰ç«¯ç²å–åˆ° token ä½†ä½¿ç”¨æ™‚è¿”å› 401 Unauthorized éŒ¯èª¤ã€‚

**åŸå› **ï¼š
- JWT é©—è­‰å¯†é‘°ä¸ä¸€è‡´
- ç¼ºå°‘å¿…è¦çš„ç’°å¢ƒè®Šé‡é…ç½®

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ·»åŠ å’Œçµ±ä¸€ JWT å¯†é‘°ï¼š
```
# åœ¨ .env ä¸­æ·»åŠ 
JWT_SECRET=donow-jwt-secret-key-2024
```

2. å„ªåŒ– auth ä¸­é–“ä»¶ï¼Œæ·»åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
// ç²å– JWT å¯†é‘°
const jwtSecret = process.env.JWT_SECRET || 'donow-jwt-secret-key-2024';
console.log('ä½¿ç”¨ JWT å¯†é‘°:', jwtSecret.substring(0, 5) + '...');

// é©—è­‰token
const decoded = jwt.verify(token, jwtSecret);
```

3. ç¢ºä¿æ­£ç¢ºè¨­ç½® FRONTEND_URL å’Œ OAUTH_TARGET_ROUTEï¼š
```
# å‰ç«¯ URL
FRONTEND_URL=http://localhost:3000

# OAuth è·¯ç”±è¨­å®š
OAUTH_TARGET_ROUTE=auth
```

### 19.3 Cookie èˆ‡ Authorization Header è™•ç†

**å•é¡Œ**ï¼šå‰ç«¯ç™¼é€çš„ Authorization é ­éƒ¨æœªæ­£ç¢ºå‚³éæˆ–è™•ç†ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ AuthContext ä¸­æ·»åŠ æ›´è©³ç´°çš„æ—¥èªŒè¼¸å‡º
2. åœ¨å¾Œç«¯ auth ä¸­é–“ä»¶ä¸­æ·»åŠ è«‹æ±‚å’Œé ­éƒ¨åˆ†ææ—¥èªŒ
3. ç¢ºä¿ CORS è¨­ç½®æ­£ç¢ºæ”¯æŒ credentials

### 19.4 éŒ¯èª¤è™•ç†æ”¹é€²

**å•é¡Œ**ï¼šéŒ¯èª¤è¨Šæ¯ä¸å¤ è©³ç´°ï¼Œé›£ä»¥è¨ºæ–·å•é¡Œæ‰€åœ¨ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ auth ä¸­é–“ä»¶ä¸­å¢åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
console.log('èªè­‰ä¸­é–“ä»¶è™•ç†è«‹æ±‚è·¯å¾‘:', req.path);
console.log('Authorization é ­éƒ¨:', req.headers.authorization);
console.log('Cookie ä¸­çš„ token:', req.cookies.accessToken);
console.log('ä½¿ç”¨çš„ token:', token ? token.substring(0, 15) + '...' : 'null');
```

2. åœ¨éŒ¯èª¤éŸ¿æ‡‰ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼š
```javascript
return res.status(401).json({ 
  success: false, 
  message: 'ç„¡æ•ˆçš„æˆæ¬Š',
  error: error.message
});
```

## äºŒåã€å¾ŒçºŒå·¥ä½œé …ç›®

- [x] å¯¦ç¾ç”¨æˆ¶è³‡æ–™èˆ‡ä»»å‹™/å°ˆæ¡ˆçš„æ•¸æ“šé—œè¯
- [x] ç¢ºä¿ç”¨æˆ¶åªèƒ½è¨ªå•è‡ªå·±çš„è³‡æºï¼ˆæ¬Šé™æ§åˆ¶ï¼‰
- [x] æ›´æ–°æ‰€æœ‰å‰ç«¯ API æœå‹™æ·»åŠ æˆæ¬Šé ­éƒ¨
  - [x] å·²æ›´æ–° App.js ä¸­çš„æ‰€æœ‰ API è«‹æ±‚
  - [x] å·²æ›´æ–° taskService.js æœå‹™
  - [x] å·²æ›´æ–° projectService.js æœå‹™ 
  - [x] å·²æ›´æ–° reportService.js æœå‹™
  - [x] å·²å®Œæˆæ‰€æœ‰ API create/update/delete æ“ä½œçš„æˆæ¬Šæª¢æŸ¥
- [x] æ¸¬è©¦æ‰€æœ‰ç”¨æˆ¶é—œè¯åŠŸèƒ½
  - [x] å·²æ¸¬è©¦ç™»å…¥/ç™»å‡ºåŠŸèƒ½
  - [x] å·²å®Œå–„ç™»å‡ºæ™‚çš„æ•¸æ“šæ¸…ç†åŠŸèƒ½
  - [x] å·²æ¸¬è©¦ç”¨æˆ¶æ¬Šé™æ§åˆ¶
- [ ] æ·»åŠ ç”¨æˆ¶å€‹äººè¨­å®šé é¢
- [ ] å„ªåŒ–ç™»å…¥é é¢çš„ä½¿ç”¨é«”é©—
- [ ] è€ƒæ…®å¢åŠ å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥é¸é …ï¼ˆå¦‚ Facebook, Appleï¼‰

## äºŒåä¸€ã€ç”¨æˆ¶ç•Œé¢å±•ç¤º

### 21.1 ç™»å…¥æŒ‰éˆ•èˆ‡ç”¨æˆ¶ç‹€æ…‹å±•ç¤º

æ‡‰ç”¨é ‚éƒ¨å°èˆªæ¬„ä¸­çš„ç™»å…¥/ç™»å‡ºæŒ‰éˆ•è¨­è¨ˆï¼š

```jsx
{/* ç”¨æˆ¶èªè­‰æŒ‰éˆ• */}
{currentUser ? (
  <Button 
    variant="outlined"
    color="primary"
    size="small"
    onClick={logout}
    endIcon={<LogoutIcon />}
    sx={{ mr: 1 }}
  >
    {currentUser.name || 'ç”¨æˆ¶'} ç™»å‡º
  </Button>
) : (
  <Button 
    variant="contained"
    color="primary"
    size="small"
    onClick={handleAuthModalOpen}
    startIcon={<PersonIcon />}
    sx={{ mr: 1 }}
  >
    ç™»å…¥
  </Button>
)}
```

### 21.2 ç™»å…¥/è¨»å†Šæ¨¡æ…‹æ¡†

ç™»å…¥/è¨»å†Šæ¨¡æ…‹æ¡†è¨­è¨ˆï¼Œæ”¯æŒæœ¬åœ°å¸³è™Ÿå’Œ Google ç™»å…¥ï¼š

- æœ¬åœ°å¸³è™Ÿæ”¯æŒè¡¨å–®é©—è­‰
- æ”¯æŒåœ¨ç™»å…¥/è¨»å†Šæ¨¡å¼é–“åˆ‡æ›
- Google ç™»å…¥æ”¯æŒä½¿ç”¨ OAuth 2.0 èªè­‰

ç™»å…¥æˆåŠŸå¾Œï¼Œæ¨¡æ…‹æ¡†è‡ªå‹•é—œé–‰ï¼Œç”¨æˆ¶ç‹€æ…‹è¢«æ›´æ–°ï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•ã€‚

### 21.3 èº«ä»½é©—è­‰æ•¸æ“šæµ

1. ç”¨æˆ¶é»æ“Šã€Œç™»å…¥ã€æŒ‰éˆ•ï¼Œæ‰“é–‹ç™»å…¥æ¨¡æ…‹æ¡†
2. ç”¨æˆ¶é¸æ“‡ç™»å…¥æ–¹å¼ï¼ˆæœ¬åœ°å¸³è™Ÿæˆ– Googleï¼‰
3. ç™»å…¥æˆåŠŸå¾Œï¼Œå¾Œç«¯ç”Ÿæˆ JWT ä»¤ç‰Œ
4. å‰ç«¯å°‡ä»¤ç‰Œä¿å­˜åˆ° localStorage
5. ä½¿ç”¨è©²ä»¤ç‰Œç™¼èµ· `/api/auth/me` è«‹æ±‚ç²å–ç”¨æˆ¶è³‡æ–™
6. æˆåŠŸå¾Œï¼Œæ›´æ–° UI é¡¯ç¤ºç”¨æˆ¶ä¿¡æ¯å’Œç™»å‡ºæŒ‰éˆ•
7. ç”¨æˆ¶é»æ“Šã€Œç™»å‡ºã€æŒ‰éˆ•ï¼Œæ¸…é™¤ localStorage ä¸­çš„ä»¤ç‰Œ
8. UI æ›´æ–°ç‚ºæœªç™»å…¥ç‹€æ…‹ 

## äºŒåäºŒã€å‰ç«¯ API æ•´åˆçµ±ä¸€æ¨¡å¼

ç‚ºç¢ºä¿æ•´åˆéç¨‹ä¸€è‡´ä¸”é¢¨éšªæœ€å°ï¼Œæˆ‘å€‘æ¡ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š

### 22.1 æˆæ¬Šé ­éƒ¨è™•ç†æ–¹å¼

åœ¨ App.js ä¸­ï¼Œæˆ‘å€‘å·²ç¶“å¯¦ç¾äº† getAuthHeaders å‡½æ•¸ä¾†ç²å–æˆæ¬Šé ­éƒ¨ï¼š

```javascript
// ç²å–æˆæ¬Šé ­éƒ¨
const getAuthHeaders = () => {
  const token = localStorage.getItem('token');
  const headers = {
    'Content-Type': 'application/json'
  };
  
  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }
  
  return headers;
};
```

æ‰€æœ‰ API è«‹æ±‚æ‡‰ä½¿ç”¨é€™ç¨®æ¨¡å¼æ·»åŠ æˆæ¬Šé ­éƒ¨ï¼š

```javascript
const response = await fetch(`${API_URL}/api/endpoint`, {
  method: 'GET', // æˆ– 'POST', 'PUT', 'DELETE' ç­‰
  headers: getAuthHeaders(),
  credentials: 'include',
  body: JSON.stringify(data) // å¦‚æœéœ€è¦
});
```

### 22.2 å¯¦æ–½æ­¥é©Ÿ

å°æ–¼æ¯å€‹æœå‹™æ–‡ä»¶ï¼ˆå¦‚ taskService.js, projectService.js ç­‰ï¼‰ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ·»åŠ æˆæ¬Šï¼š

1. åœ¨æœå‹™æ–‡ä»¶é ‚éƒ¨æ·»åŠ  getAuthHeaders å‡½æ•¸ï¼š
   ```javascript
   const getAuthHeaders = () => {
     const token = localStorage.getItem('token');
     const headers = {
       'Content-Type': 'application/json'
     };
     
     if (token) {
       headers['Authorization'] = `Bearer ${token}`;
     }
     
     return headers;
   };
   ```

2. æ›´æ–°æ‰€æœ‰ API è«‹æ±‚ï¼Œæ·»åŠ æˆæ¬Šé ­éƒ¨å’Œ credentialsï¼š
   ```javascript
   const response = await fetch(url, {
     headers: getAuthHeaders(),
     credentials: 'include'
   });
   ```

æ­¤æ–¹æ³•çš„å„ªé»ï¼š
- ä¿æŒèˆ‡ç¾æœ‰ä»£ç¢¼ä¸€è‡´
- ä¸å¼•å…¥æ–°çš„ä¾è³´æˆ–æ¶æ§‹æ›´æ”¹
- æ¯å€‹æ–‡ä»¶ç¨ç«‹ï¼Œæ¸›å°‘å¼•ç”¨éŒ¯èª¤é¢¨éšª
- ä¿®æ”¹ç¯„åœæœ€å°ï¼Œé™ä½å‡ºéŒ¯æ©Ÿç‡

### 22.3 é•·æœŸè¨ˆåŠƒ

æœªä¾†é‡æ§‹æ™‚ï¼Œå¯ä»¥è€ƒæ…®ä»¥ä¸‹æ–¹æ¡ˆï¼š
- å°‡ getAuthHeaders é·ç§»è‡³ä¸­å¤®æˆæ¬Šæœå‹™
- ä½¿ç”¨è«‹æ±‚æ””æˆªå™¨ï¼ˆå¦‚ä½¿ç”¨ Axiosï¼‰
- æ•´åˆè‡³çµ±ä¸€çš„ç‹€æ…‹ç®¡ç†ï¼ˆå¦‚ Reduxï¼‰

ä½†ç›®å‰éšæ®µï¼Œæˆ‘å€‘å„ªå…ˆè€ƒæ…®ç©©å®šæ€§å’Œä¸€è‡´æ€§ï¼Œéµå¾ªç¾æœ‰æ¨¡å¼é€²è¡Œæ¼¸é€²å¼æ•´åˆã€‚ 

## äºŒåä¸‰ã€ç™»å‡ºæ•¸æ“šæ¸…ç†å¯¦ç¾

ç‚ºè§£æ±ºç”¨æˆ¶ç™»å‡ºå¾Œæ•¸æ“šä»ç„¶é¡¯ç¤ºçš„å•é¡Œï¼Œæˆ‘å€‘å¯¦ç¾äº†çµ±ä¸€çš„æ•¸æ“šæ¸…ç†æ©Ÿåˆ¶ã€‚è©²æ©Ÿåˆ¶ç¢ºä¿ç•¶ç”¨æˆ¶ç™»å‡ºæ™‚ï¼Œæ‰€æœ‰çµ„ä»¶ä¸­çš„æ•¸æ“šéƒ½è¢«æ¸…ç©ºã€‚

### 23.1 å¯¦ç¾æ–¹å¼

æˆ‘å€‘æ¡ç”¨äº†æœ€å°å¹²æ“¾åŸå‰‡ï¼Œç‚ºæ¯å€‹çµ„ä»¶æ·»åŠ äº†å° `currentUser` ç‹€æ…‹çš„ç›£è½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¤‡é›œçš„äº‹ä»¶ç³»çµ±ã€‚ç•¶ `currentUser` è®Šç‚º null æ™‚ï¼Œå„çµ„ä»¶è‡ªè¡Œæ¸…ç†è‡ªå·±çš„æ•¸æ“šç‹€æ…‹ã€‚

### 23.2 å·²å®Œæˆçµ„ä»¶æ›´æ–°

ä»¥ä¸‹çµ„ä»¶å·²ç¶“å¯¦ç¾äº†ç™»å‡ºæ•¸æ“šæ¸…ç†ï¼š

1. **App.js**
   - æ¸…ç†è¨ˆæ™‚å™¨æ•¸æ“šå’Œæ­·å²è¨˜éŒ„
   - ç•¶è¨ˆæ™‚å™¨æ­£åœ¨é‹è¡Œæ™‚ï¼Œæœƒå…ˆçµæŸè¨ˆæ™‚å™¨å†æ¸…ç†æ•¸æ“š

2. **ProjectManager.js**
   - æ¸…ç†å°ˆæ¡ˆåˆ—è¡¨
   - æ¸…ç†å°ˆæ¡ˆçµ±è¨ˆæ•¸æ“š
   - æ¸…ç†é¸ä¸­çš„å°ˆæ¡ˆ

3. **TaskManager.js**
   - æ¸…ç†ä»»å‹™åˆ—è¡¨
   - æ¸…ç†ä»»å‹™ç·¨è¼¯å™¨ç‹€æ…‹

4. **HabitMode.js**
   - æ¸…ç†ç¿’æ…£ä»»å‹™åˆ—è¡¨
   - æ¸…ç†ç¿’æ…£è¨˜éŒ„
   - æ¸…ç†é¸ä¸­çš„ç¿’æ…£ä»»å‹™

5. **TaskSelector.js**
   - æ¸…ç†ä»»å‹™ä¸‹æ‹‰åˆ—è¡¨
   - æ¸…ç†è¼¸å…¥å’ŒéŒ¯èª¤ç‹€æ…‹
   
6. **ProjectActionList.js**
   - æ¸…ç†å°ˆæ¡ˆç›¸é—œçš„è¡Œå‹•è¨˜éŒ„
   - æ·»åŠ ç”¨æˆ¶èªè­‰æª¢æŸ¥ï¼Œæœªç™»å…¥æ™‚ä¸é¡¯ç¤ºå…§å®¹

### 23.3 é›£é»åŠè§£æ±ºæ–¹æ¡ˆ

1. **æ™‚é–“çµ±è¨ˆé é¢å•é¡Œ**
   - å•é¡Œï¼šæ™‚é–“çµ±è¨ˆé é¢åœ¨ç™»å‡ºå¾Œä»é¡¯ç¤ºæ•¸æ“š
   - åŸå› ï¼šTabPanel åˆ‡æ›æ™‚çš„æ•¸æ“šç²å–æ²’æœ‰è€ƒæ…®ç”¨æˆ¶ç™»å‡ºæƒ…æ³
   - è§£æ±ºæ–¹æ¡ˆï¼š
     - ä¿®æ”¹ useEffect æ·»åŠ å° currentUser çš„æª¢æŸ¥
     - åœ¨ renderStatsContent å‡½æ•¸æ·»åŠ æœªç™»å…¥æç¤º
     - åœ¨ ProjectActionList çµ„ä»¶å¢åŠ å°ç”¨æˆ¶èªè­‰çš„æª¢æŸ¥

2. **æˆæ¬Šé ­éƒ¨å•é¡Œ**
   - å•é¡Œï¼šéƒ¨åˆ† API è«‹æ±‚æ²’æœ‰æ·»åŠ æˆæ¬Šé ­éƒ¨
   - è§£æ±ºæ–¹æ¡ˆï¼š
     - çµ±ä¸€ä½¿ç”¨ getAuthHeaders å‡½æ•¸ç²å–æˆæ¬Šé ­éƒ¨
     - ç¢ºä¿æ‰€æœ‰è«‹æ±‚éƒ½åŒ…å« credentials: 'include'

### 23.4 æ¸¬è©¦çµæœ

æ‰€æœ‰çµ„ä»¶ç¾åœ¨éƒ½èƒ½æ­£ç¢ºè™•ç†ç”¨æˆ¶ç™»å‡ºæƒ…æ³ï¼š
- ç™»å‡ºå¾Œç«‹å³æ¸…ç©ºæ•¸æ“šï¼Œä¸å†é¡¯ç¤ºå‰ä¸€å€‹ç”¨æˆ¶çš„æ•¸æ“š
- çµ„ä»¶åœ¨é¡¯ç¤ºå‰æœƒæª¢æŸ¥ç”¨æˆ¶ç™»å…¥ç‹€æ…‹
- æœªç™»å…¥æ™‚é¡¯ç¤ºé©ç•¶çš„æç¤ºæˆ–ä¸é¡¯ç¤ºæ•æ„Ÿå…§å®¹

### 23.5 å¾ŒçºŒå·¥ä½œ

éœ€è¦å®Œæˆçš„ç™»å…¥/æˆæ¬Šç›¸é—œå·¥ä½œï¼š
1. æª¢æŸ¥æ‰€æœ‰ create/update æ“ä½œæ˜¯å¦å·²æ·»åŠ æˆæ¬Šé ­éƒ¨
2. å„ªåŒ–ç”¨æˆ¶é«”é©—ï¼Œæ·»åŠ åˆé©çš„éŒ¯èª¤è™•ç†å’Œæç¤º
3. è€ƒæ…®å¯¦ç¾è¨˜ä½ç™»å…¥ç‹€æ…‹åŠŸèƒ½

## äºŒåå››ã€ç”¨æˆ¶å€‹äººè¨­å®šé é¢

### 24.1 å¯¦ç¾æ–¹å¼

åœ¨ç”¨æˆ¶å€‹äººè¨­å®šé é¢ä¸­ï¼Œç”¨æˆ¶å¯ä»¥ä¿®æ”¹å€‹äººè³‡æ–™ï¼Œå¦‚åå­—ã€é›»å­éƒµä»¶ç­‰ã€‚

### 24.2 å„ªåŒ–é«”é©—

1. åœ¨ä¿®æ”¹è³‡æ–™å¾Œï¼Œç«‹å³é¡¯ç¤ºæ›´æ–°å¾Œçš„è³‡æ–™
2. æ·»åŠ è³‡æ–™é©—è­‰ï¼Œç¢ºä¿è¼¸å…¥çš„æœ‰æ•ˆæ€§
3. åœ¨ä¿å­˜æ™‚é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º

## äºŒåäº”ã€å„ªåŒ–ç™»å…¥é é¢

### 25.1 å¯¦ç¾æ–¹å¼

åœ¨ç™»å…¥é é¢ä¸­ï¼Œç”¨æˆ¶å¯ä»¥é¸æ“‡ä¸åŒçš„ç™»å…¥æ–¹å¼ï¼Œå¦‚æœ¬åœ°å¸³è™Ÿã€Google ç™»å…¥ç­‰ã€‚

### 25.2 å„ªåŒ–é«”é©—

1. åœ¨é¸æ“‡ç™»å…¥æ–¹å¼å¾Œï¼Œç«‹å³é¡¯ç¤ºç›¸æ‡‰çš„ç™»å…¥è¡¨å–®
2. åœ¨ç™»å…¥éç¨‹ä¸­é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º
3. åœ¨ç™»å…¥æˆåŠŸå¾Œï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•

## äºŒåå…­ã€è€ƒæ…®å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥

### 26.1 å¯¦ç¾æ–¹å¼

åœ¨ç™»å…¥é é¢ä¸­æ·»åŠ å…¶ä»–ç¬¬ä¸‰æ–¹ç™»å…¥é¸é …ï¼Œå¦‚ Facebook, Apple ç­‰ã€‚

### 26.2 å„ªåŒ–é«”é©—

1. åœ¨é¸æ“‡ç¬¬ä¸‰æ–¹ç™»å…¥å¾Œï¼Œç«‹å³é¡¯ç¤ºç›¸æ‡‰çš„ç™»å…¥è¡¨å–®
2. åœ¨ç™»å…¥éç¨‹ä¸­é¡¯ç¤ºè™•ç†ä¸­ç‹€æ…‹ï¼Œä¸¦æä¾›éŒ¯èª¤æç¤º
3. åœ¨ç™»å…¥æˆåŠŸå¾Œï¼Œé¡¯ç¤ºç”¨æˆ¶åå’Œç™»å‡ºæŒ‰éˆ•

## äºŒåä¸ƒã€ç¸½çµ

æ•´åˆå®Œæˆå¾Œçš„ç¶­è­·å·¥ä½œ

### å¾ŒçºŒå·¥ä½œï¼š

1. **ç›£æ§å’Œæ—¥èªŒ**ï¼šè¨­ç½®èªè­‰ç³»çµ±çš„å°ˆé–€ç›£æ§
2. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæª¢æŸ¥ä¸¦æ›´æ–°èªè­‰ç›¸é—œä¾è³´
3. **ç”¨æˆ¶åé¥‹**ï¼šæ”¶é›†ç”¨æˆ¶å°ç™»å…¥é«”é©—çš„åé¥‹ä¸¦è¿­ä»£æ”¹é€²
4. **æ“´å±•è¨ˆåŠƒ**ï¼šè€ƒæ…®æ·»åŠ å…¶ä»–èªè­‰æ–¹å¼ï¼ˆå¦‚ Facebook, Apple ç™»å…¥ï¼‰

---

## åŸ·è¡Œç‹€æ…‹è¿½è¹¤

| å·¥ä½œé …ç›® | ç‹€æ…‹ | å®Œæˆæ—¥æœŸ | è² è²¬äºº | å‚™è¨» |
|---------|------|---------|-------|------|
| å‰µå»ºæ•´åˆæ–‡æª” | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬ |
| å¾Œç«¯è·¯ç”±é·ç§» | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | è·¯ç”±å·²å­˜åœ¨ |
| Passport é…ç½®æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ·»åŠ  getCallbackURL å‡½æ•¸ |
| JWT å®‰å…¨æ€§å¢å¼· | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | åœ¨ auth.js ä¸­å¢å¼· JWT é…ç½® |
| ç’°å¢ƒé…ç½® | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æª¢æŸ¥ä¸¦ç¢ºèªç’°å¢ƒé…ç½® |
| å‰ç«¯çµ„ä»¶é–‹ç™¼ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»º Auth.jsx å’Œ AuthContext.jsx |
| API ç«¯é»æ›´æ–° | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–°æ‰€æœ‰APIèª¿ç”¨ç‚ºæ­£å¼ç«¯é» |
| å‰ç«¯çµ„ä»¶æ•´åˆ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ¡ç”¨æ¨¡æ…‹æ¡†è¨­è¨ˆæˆåŠŸæ•´åˆåˆ°App.js |
| UIè¨­è¨ˆèª¿æ•´ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | èª¿æ•´æŒ‰éˆ•æ¨£å¼èˆ‡ä½ç½®ï¼Œç¢ºä¿èˆ‡ç¾æœ‰UIä¸€è‡´ |
| æ¸¬è©¦æœ¬åœ°ç™»å…¥ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æœ¬åœ°å¸³è™Ÿè¨»å†Šå’Œç™»å…¥åŠŸèƒ½å·²æ¸¬è©¦é€šé |
| æ¸¬è©¦Google OAuth | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Googleç™»å…¥æµç¨‹æ¸¬è©¦é€šé |
| æ¨¡å‹æ·»åŠ ç”¨æˆ¶é—œè¯ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | Projectã€Taskã€Action æ¨¡å‹æ·»åŠ  userId å­—æ®µ |
| æ•¸æ“šé·ç§»å¯¦ç¾ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºä¸¦åŸ·è¡Œé·ç§»è…³æœ¬ï¼ŒæˆåŠŸé—œè¯ 66 æ¢è¨˜éŒ„ |
| æ¬Šé™æª¢æŸ¥ä¸­é–“ä»¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | å‰µå»ºé€šç”¨ checkOwnership ä¸­é–“ä»¶ |
| å¾Œç«¯è·¯ç”±æ¬Šé™æ§åˆ¶ | âœ… å·²å®Œæˆ | 2024-06-XX | AI åŠ©æ‰‹ | æ›´æ–° projectsã€tasksã€timer è·¯ç”±æ·»åŠ æ¬Šé™æª¢æŸ¥ |
| å‰ç«¯æœå‹™æˆæ¬Šæ›´æ–° | ğŸ”„ é€²è¡Œä¸­ | - | AI åŠ©æ‰‹ | å·²æ›´æ–° taskService.jsï¼Œå…¶ä»–æœå‹™å¾…æ›´æ–° |
| ... | ... | ... | ... | ... |

## äºŒåä¹ã€é©—è­‰å•é¡Œæ’é™¤ç´€éŒ„

åœ¨å‰å¾Œç«¯æ•´åˆéç¨‹ä¸­é‡åˆ°çš„ä¸»è¦å•é¡ŒåŠè§£æ±ºæ–¹æ¡ˆï¼š

### 29.1 å‰ç«¯æ¨¡æ…‹æ¡†ç‹€æ…‹ä¿ç•™å•é¡Œ

**å•é¡Œ**ï¼šæœ¬åœ°å¸³æˆ¶ç™»å…¥ç™»å‡ºå¾Œï¼Œå†æ¬¡é»æ“Šç™»å…¥ç•«é¢æ™‚ï¼Œå‰ä¸€æ¬¡çš„ã€Œç™»å…¥æˆåŠŸã€æç¤ºä»ç„¶é¡¯ç¤ºã€‚è¨»å†ŠæˆåŠŸå¾Œä¹Ÿæœ‰é¡ä¼¼å•é¡Œã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨æ¨¡æ…‹æ¡†æ‰“é–‹æ™‚é‡ç½®æ‰€æœ‰ç‹€æ…‹
useEffect(() => {
  if (open) {
    setMessage('');
    setEmail('');
    setPassword('');
    setName('');
    setFormErrors({
      email: '',
      password: '',
      name: ''
    });
  }
}, [open]);
```

### 29.2 Google OAuth èªè­‰å•é¡Œ

**å•é¡Œ**ï¼šGoogle ç™»å…¥å¤±æ•—ï¼Œå‰ç«¯ç²å–åˆ° token ä½†ä½¿ç”¨æ™‚è¿”å› 401 Unauthorized éŒ¯èª¤ã€‚

**åŸå› **ï¼š
- JWT é©—è­‰å¯†é‘°ä¸ä¸€è‡´
- ç¼ºå°‘å¿…è¦çš„ç’°å¢ƒè®Šé‡é…ç½®

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ·»åŠ å’Œçµ±ä¸€ JWT å¯†é‘°ï¼š
```
# åœ¨ .env ä¸­æ·»åŠ 
JWT_SECRET=donow-jwt-secret-key-2024
```

2. å„ªåŒ– auth ä¸­é–“ä»¶ï¼Œæ·»åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
// ç²å– JWT å¯†é‘°
const jwtSecret = process.env.JWT_SECRET || 'donow-jwt-secret-key-2024';
console.log('ä½¿ç”¨ JWT å¯†é‘°:', jwtSecret.substring(0, 5) + '...');

// é©—è­‰token
const decoded = jwt.verify(token, jwtSecret);
```

3. ç¢ºä¿æ­£ç¢ºè¨­ç½® FRONTEND_URL å’Œ OAUTH_TARGET_ROUTEï¼š
```
# å‰ç«¯ URL
FRONTEND_URL=http://localhost:3000

# OAuth è·¯ç”±è¨­å®š
OAUTH_TARGET_ROUTE=auth
```

### 29.3 Cookie èˆ‡ Authorization Header è™•ç†

**å•é¡Œ**ï¼šå‰ç«¯ç™¼é€çš„ Authorization é ­éƒ¨æœªæ­£ç¢ºå‚³éæˆ–è™•ç†ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ AuthContext ä¸­æ·»åŠ æ›´è©³ç´°çš„æ—¥èªŒè¼¸å‡º
2. åœ¨å¾Œç«¯ auth ä¸­é–“ä»¶ä¸­æ·»åŠ è«‹æ±‚å’Œé ­éƒ¨åˆ†ææ—¥èªŒ
3. ç¢ºä¿ CORS è¨­ç½®æ­£ç¢ºæ”¯æŒ credentials

### 29.4 éŒ¯èª¤è™•ç†æ”¹é€²

**å•é¡Œ**ï¼šéŒ¯èª¤è¨Šæ¯ä¸å¤ è©³ç´°ï¼Œé›£ä»¥è¨ºæ–·å•é¡Œæ‰€åœ¨ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ auth ä¸­é–“ä»¶ä¸­å¢åŠ è©³ç´°æ—¥èªŒï¼š
```javascript
console.log('èªè­‰ä¸­é–“ä»¶è™•ç†è«‹æ±‚è·¯å¾‘:', req.path);
console.log('Authorization é ­éƒ¨:', req.headers.authorization);
console.log('Cookie ä¸­çš„ token:', req.cookies.accessToken);
console.log('ä½¿ç”¨çš„ token:', token ? token.substring(0, 15) + '...' : 'null');
```

2. åœ¨éŒ¯èª¤éŸ¿æ‡‰ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼š
```javascript
return res.status(401).json({ 
  success: false, 
  message: 'ç„¡æ•ˆçš„æˆæ¬Š',
  error: error.message
});
```

## äºŒåå…«ã€ç”¨æˆ¶èªè­‰ç‹€æ…‹è™•ç†å„ªåŒ–

ç‚ºäº†è§£æ±º "429 Too Many Requests" éŒ¯èª¤ï¼Œæˆ‘å€‘é€²è¡Œäº†ä¸€ç³»åˆ—å„ªåŒ–ï¼Œç¢ºä¿åœ¨ç”¨æˆ¶æœªç™»å…¥ç‹€æ…‹ä¸‹ä¸æœƒç™¼é€ä»»ä½• API è«‹æ±‚ã€‚é€™äº›ä¿®æ”¹å¤§å¤§æ¸›å°‘äº†ç³»çµ±è³‡æºå ç”¨ä¸¦æé«˜äº†ç”¨æˆ¶é«”é©—ã€‚

### 28.1 ä¸»è¦å•é¡Œåˆ†æèˆ‡è§£æ±º

**ç™¼ç¾çš„å•é¡Œ**ï¼š
- ç”¨æˆ¶ç™»å‡ºå¾Œï¼Œå¤šå€‹çµ„ä»¶ä»ç¹¼çºŒç™¼é€ API è«‹æ±‚
- åˆ·æ–°é é¢æ™‚ï¼ŒæŸäº›çµ„ä»¶åœ¨é©—è­‰ç”¨æˆ¶ç‹€æ…‹å‰å°±é–‹å§‹è«‹æ±‚æ•¸æ“š
- éƒ¨åˆ†çµ„ä»¶åŒ…å«å®šæ™‚å™¨ï¼ŒæŒçºŒç™¼é€ API è«‹æ±‚
- é€™äº›ç„¡æ•ˆè«‹æ±‚å®¹æ˜“å°è‡´ "429 Too Many Requests" éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç‚ºæ‰€æœ‰ç™¼é€ API è«‹æ±‚çš„çµ„ä»¶æ·»åŠ  `currentUser` æª¢æŸ¥
- ä¿®æ”¹ `useEffect` ä¾è³´é …ï¼Œç¢ºä¿çµ„ä»¶ç‹€æ…‹éŸ¿æ‡‰ç™»å…¥ç‹€æ…‹è®ŠåŒ–
- å„ªåŒ–å®šæ™‚å™¨é‚è¼¯ï¼Œåƒ…åœ¨ç”¨æˆ¶ç™»å…¥æ™‚å•Ÿå‹•å’Œé‹è¡Œ

### 28.2 ä¸»è¦ä¿®æ”¹çµ„ä»¶æ¸…å–®

| çµ„ä»¶æ–‡ä»¶ | ä¿®æ”¹å…§å®¹ | ç‹€æ…‹ |
|---------|---------|------|
| App.js | ä¿®æ”¹äº†åˆå§‹è¼‰å…¥å’Œå®šæ™‚æ›´æ–°é‚è¼¯ï¼Œç¢ºä¿åªåœ¨ç”¨æˆ¶ç™»å…¥æ™‚åŸ·è¡Œ | âœ… å·²å®Œæˆ |
| ProjectManager.js | ä¿®æ”¹åˆå§‹è¼‰å…¥é‚è¼¯ï¼Œåªåœ¨ç”¨æˆ¶ç™»å…¥æ™‚è«‹æ±‚æ•¸æ“š | âœ… å·²å®Œæˆ |
| TaskManager.js | ä¿®æ”¹åˆå§‹è¼‰å…¥é‚è¼¯ï¼Œç¢ºä¿æœªç™»å…¥æ™‚ä¸åŠ è¼‰ä»»å‹™åˆ—è¡¨ | âœ… å·²å®Œæˆ |
| HabitMode.js | ä¿®æ”¹åˆå§‹è¼‰å…¥é‚è¼¯ï¼Œç¢ºä¿æœªç™»å…¥æ™‚ä¸åŠ è¼‰ç¿’æ…£åˆ—è¡¨ | âœ… å·²å®Œæˆ |
| TaskSelector.js | ä¿®æ”¹åˆå§‹è¼‰å…¥å’Œ context è®ŠåŒ–é‚è¼¯ï¼Œåƒ…åœ¨ç™»å…¥æ™‚åŠ è¼‰ | âœ… å·²å®Œæˆ |
| ProjectActionList.js | ä¿®æ”¹åˆå§‹è¼‰å…¥é‚è¼¯ï¼Œç¢ºä¿æœªç™»å…¥æ™‚ä¸åŠ è¼‰è¡Œå‹•è¨˜éŒ„ | âœ… å·²å®Œæˆ |
| TimeStats.js | æ·»åŠ äº†ç”¨æˆ¶ç™»å…¥æª¢æŸ¥å’Œæœªç™»å…¥æç¤º | âœ… å·²å®Œæˆ |
| ReportExportDialog.js | æ·»åŠ ç”¨æˆ¶ç™»å…¥æª¢æŸ¥ï¼Œç¢ºä¿åŒ¯å‡ºå’Œä¿å­˜è¦–åœ–å‰é©—è­‰ç™»å…¥ç‹€æ…‹ | âœ… å·²å®Œæˆ |
| TaskTester.js | æ·»åŠ ç”¨æˆ¶ç™»å…¥æª¢æŸ¥ï¼Œæœªç™»å…¥æ™‚é¡¯ç¤ºæç¤ºè€Œéè«‹æ±‚API | âœ… å·²å®Œæˆ |

### 28.3 é—œéµä¿®æ”¹ç¤ºä¾‹

ä»¥ä¸‹æ˜¯å¹¾å€‹æ ¸å¿ƒçµ„ä»¶çš„é—œéµä¿®æ”¹ï¼š

#### App.js ä¸­çš„å®šæ™‚å™¨é‚è¼¯å„ªåŒ–ï¼š

```javascript
// åˆå§‹è¼‰å…¥å’Œå®šæœŸæ›´æ–°
useEffect(() => {
  // åªæœ‰ç•¶ç”¨æˆ¶å·²ç™»å…¥ä¸”æ¨¡å¼ç‚º timer æ™‚æ‰ç²å–æ•¸æ“šå’Œè¨­ç½®å®šæ™‚å™¨
  if (currentUser && mode === 'timer') {
    fetchActions();
    
    // å¦‚æœæ­£åœ¨è¨ˆæ™‚ï¼Œè¨­ç½®å®šæœŸæ›´æ–°
    const interval = setInterval(() => {
      if (isActive) {
        fetchActions();
      }
    }, 10 * 60 * 1000); // æ¯ 10 åˆ†é˜æ›´æ–°ä¸€æ¬¡

    return () => clearInterval(interval);
  }
}, [mode, isActive, currentUser]); // æ·»åŠ  currentUser ä½œç‚ºä¾è³´é …
```

#### ProjectActionList.js ä¸­ç¢ºä¿åƒ…åœ¨æœ‰ç”¨æˆ¶å’Œå°ˆæ¡ˆ ID æ™‚æ‰è«‹æ±‚æ•¸æ“šï¼š

```javascript
useEffect(() => {
  // åªæœ‰ç•¶ç”¨æˆ¶å·²ç™»å…¥ä¸”æœ‰å°ˆæ¡ˆ ID æ™‚æ‰ç²å–æ•¸æ“š
  if (currentUser && projectId) {
    fetchActions();
  }
}, [fetchActions, currentUser, projectId]);
```

#### TimeStats.js ä¸­æ·»åŠ æœªç™»å…¥æç¤ºï¼š

```javascript
// å¦‚æœç”¨æˆ¶æœªç™»å…¥ï¼Œé¡¯ç¤ºæç¤ºä¿¡æ¯
if (!currentUser) {
  return (
    <Box p={3}>
      <Alert severity="info">è«‹ç™»å…¥ä»¥æŸ¥çœ‹æ™‚é–“çµ±è¨ˆ</Alert>
    </Box>
  );
}
```

### 28.4 å…¶ä»–å„ªåŒ–é …

é™¤äº†ç¢ºä¿æœªç™»å…¥æ™‚ä¸ç™¼é€è«‹æ±‚å¤–ï¼Œæˆ‘å€‘é‚„é‡å° API è«‹æ±‚é€²è¡Œäº†ä»¥ä¸‹å„ªåŒ–ï¼š

1. **çµ±ä¸€çš„æˆæ¬Šé ­éƒ¨è™•ç†**ï¼š
   - æ‰€æœ‰çµ„ä»¶ä½¿ç”¨åŒä¸€ `getAuthHeaders()` å‡½æ•¸ç²å–æˆæ¬Šé ­éƒ¨
   - ç¢ºä¿æ‰€æœ‰è«‹æ±‚åŒ…å« `credentials: 'include'` é¸é …
   
2. **æœå‹™å™¨ç«¯ Rate Limit èª¿æ•´**ï¼š
   - å¢åŠ äº† API è«‹æ±‚çš„é€Ÿç‡é™åˆ¶ä¸Šé™
   - æ·»åŠ äº† `skipSuccessfulRequests: true`ï¼Œä½¿å¾—åªæœ‰å¤±æ•—çš„è«‹æ±‚æ‰è¨ˆå…¥é™åˆ¶
   - æ·»åŠ æ¨™æº–çš„ RateLimit é ­éƒ¨ï¼Œå¹«åŠ©å‰ç«¯äº†è§£é…é¡ä½¿ç”¨æƒ…æ³

3. **æ¸…ç†ç‹€æ…‹é‚è¼¯**ï¼š
   - ç”¨æˆ¶ç™»å‡ºæ™‚æ¸…ç©ºæ‰€æœ‰çµ„ä»¶çš„æ•¸æ“šç‹€æ…‹
   - ç¢ºä¿æ•æ„Ÿæ•¸æ“šä¸æœƒåœ¨ç™»å‡ºå¾Œä»ç„¶é¡¯ç¤º

### 28.5 æ•ˆæœèˆ‡å¾ŒçºŒå·¥ä½œ

é€™äº›å„ªåŒ–å¤§å¤§æ¸›å°‘äº†ä¸å¿…è¦çš„ API è«‹æ±‚æ•¸é‡ï¼Œç‰¹åˆ¥æ˜¯åœ¨ç”¨æˆ¶æœªç™»å…¥æ™‚ã€‚ä¸»è¦æ•ˆæœåŒ…æ‹¬ï¼š

- æ¸›è¼•äº†å¾Œç«¯æœå‹™å™¨å£“åŠ›ï¼Œé¿å… "429 Too Many Requests" éŒ¯èª¤
- æ”¹å–„äº†å‰ç«¯æ€§èƒ½å’Œåæ‡‰é€Ÿåº¦
- å¢å¼·äº†æ•¸æ“šå®‰å…¨æ€§ï¼Œç¢ºä¿æœªç™»å…¥ç”¨æˆ¶ä¸æœƒçœ‹åˆ°ä»»ä½•èˆŠæ•¸æ“š

**å¾ŒçºŒå·¥ä½œ**ï¼š

1. æŒçºŒç›£æ§ API è«‹æ±‚é »ç‡å’Œæ¨¡å¼
2. è€ƒæ…®å¯¦ç¾æ›´æ™ºèƒ½çš„è«‹æ±‚åˆä½µå’Œæ‰¹è™•ç†æ©Ÿåˆ¶
3. ç‚ºç”¨æˆ¶ç™»å‡ºæ“ä½œæ·»åŠ ç¢ºèªå°è©±æ¡†ï¼Œé¿å…æ„å¤–ç™»å‡º
4. ç ”ç©¶å¯¦ç¾é›¢ç·šæ¨¡å¼ï¼Œåœ¨ç¶²çµ¡ä¸ç©©å®šæ™‚ä»å¯ä½¿ç”¨åŸºæœ¬åŠŸèƒ½

## äºŒåä¹ã€æ•¸æ“šå¯«å…¥æ“ä½œèªè­‰æª¢æŸ¥å„ªåŒ–

ç‚ºäº†ç¢ºä¿ç³»çµ±å®‰å…¨æ€§ä¸¦é¿å…æœªç™»å…¥ç‹€æ…‹ä¸‹çš„éŒ¯èª¤å’Œç•°å¸¸ï¼Œæˆ‘å€‘é€²è¡Œäº†ä¸€ç³»åˆ—å„ªåŒ–ï¼Œç¢ºä¿æ‰€æœ‰æ•¸æ“šå¯«å…¥ï¼ˆcreate/update/deleteï¼‰æ“ä½œåœ¨åŸ·è¡Œå‰éƒ½æª¢æŸ¥ç”¨æˆ¶ç™»å…¥ç‹€æ…‹ã€‚

### 29.1 ä¸»è¦å•é¡Œåˆ†æèˆ‡è§£æ±º

**ç™¼ç¾çš„å•é¡Œ**ï¼š
- æŸäº›çµ„ä»¶åœ¨æœªç™»å…¥ç‹€æ…‹ä¸‹å˜—è©¦åŸ·è¡Œåˆªé™¤æ“ä½œï¼Œå°è‡´éŒ¯èª¤é¡¯ç¤º
- åˆªé™¤å°ˆæ¡ˆï¼ˆError deleting projectï¼‰éŒ¯èª¤
- åˆªé™¤ä»»å‹™ï¼ˆTask validation failedï¼‰éŒ¯èª¤
- åˆªé™¤è¡Œå‹•è¨˜éŒ„éŒ¯èª¤
- ç¿’æ…£æ¨¡å¼ä¸­çš„å‰µå»ºæ“ä½œç¼ºå°‘æˆæ¬Šæ¨™é ­
- æ›´æ–°ä»»å‹™-å°ˆæ¡ˆé—œè¯æ²’æœ‰ç”¨æˆ¶èªè­‰æª¢æŸ¥

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç‚ºæ‰€æœ‰çš„ create/update/delete æ“ä½œæ·»åŠ  `currentUser` æª¢æŸ¥
- åœ¨å˜—è©¦é€²è¡Œæ•¸æ“šå¯«å…¥å‰å…ˆé©—è­‰ç”¨æˆ¶ç™»å…¥ç‹€æ…‹
- å°æ–¼ API è«‹æ±‚ï¼Œç¢ºä¿æ·»åŠ äº†æ­£ç¢ºçš„æˆæ¬Šé ­éƒ¨ï¼ˆAuthorization headerï¼‰
- åœ¨æ“ä½œå¤±æ•—æ™‚æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯ï¼ŒæŒ‡ç¤ºéœ€è¦ç™»å…¥

### 29.2 ä¸»è¦ä¿®æ”¹çµ„ä»¶æ¸…å–®

| çµ„ä»¶æ–‡ä»¶ | ä¿®æ”¹å…§å®¹ | ç‹€æ…‹ |
|---------|---------|------|
| ProjectManager.js | æ·»åŠ åˆªé™¤å°ˆæ¡ˆå’Œæ›´æ–°ä»»å‹™-å°ˆæ¡ˆé—œè¯çš„ç”¨æˆ¶èªè­‰æª¢æŸ¥ | âœ… å·²å®Œæˆ |
| TaskManager.js | æ·»åŠ åˆªé™¤ä»»å‹™å‰çš„ç”¨æˆ¶èªè­‰æª¢æŸ¥ | âœ… å·²å®Œæˆ |
| TaskSelector.js | æ·»åŠ åˆªé™¤ä»»å‹™å‰çš„ç”¨æˆ¶èªè­‰æª¢æŸ¥ | âœ… å·²å®Œæˆ |
| App.js | æ·»åŠ åˆªé™¤è¡Œå‹•è¨˜éŒ„å‰çš„ç”¨æˆ¶èªè­‰æª¢æŸ¥ | âœ… å·²å®Œæˆ |
| HabitMode.js | æ·»åŠ å‰µå»ºç¿’æ…£ä»»å‹™å’Œè¨˜éŒ„ç¿’æ…£æ™‚çš„ç”¨æˆ¶èªè­‰æª¢æŸ¥ï¼Œä¸¦æ·»åŠ æˆæ¬Šé ­éƒ¨ | âœ… å·²å®Œæˆ |

### 29.3 å®‰å…¨è™•ç†æ¨¡å¼

ç‚ºäº†ç¶­æŒä¸€è‡´çš„å®‰å…¨è™•ç†æ¨¡å¼ï¼Œæˆ‘å€‘åœ¨æ‰€æœ‰æ•¸æ“šå¯«å…¥æ“ä½œä¸­å¯¦æ–½äº†ä»¥ä¸‹æ¨™æº–åšæ³•ï¼š

```javascript
// æ¨™æº–æ¨¡å¼ï¼šåœ¨ä»»ä½•å¯«å…¥æ“ä½œå‰æª¢æŸ¥ç”¨æˆ¶ç™»å…¥ç‹€æ…‹
const handleOperation = async (params) => {
  // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥
  if (!currentUser) {
    setError('è«‹å…ˆç™»å…¥');
    return;
  }
  
  try {
    // åŸ·è¡Œæ•¸æ“šæ“ä½œ...
  } catch (error) {
    // éŒ¯èª¤è™•ç†...
  }
};
```

é€™ç¨®çµ±ä¸€çš„è™•ç†æ–¹å¼ç¢ºä¿äº†ç³»çµ±åœ¨æœªç™»å…¥ç‹€æ…‹ä¸‹ä¸æœƒå˜—è©¦åŸ·è¡Œä»»ä½•å¯èƒ½å°è‡´éŒ¯èª¤çš„æ•¸æ“šå¯«å…¥æ“ä½œï¼ŒåŒæ™‚ç‚ºç”¨æˆ¶æä¾›äº†æ¸…æ™°çš„åé¥‹ä¿¡æ¯ã€‚

## ä¸‰åã€Mongoose æ–¹æ³•ç¾ä»£åŒ–æ›´æ–°

ç‚ºäº†è§£æ±ºæŸäº›æ“ä½œï¼ˆç‰¹åˆ¥æ˜¯åˆªé™¤æ“ä½œï¼‰å¤±æ•—çš„å•é¡Œï¼Œæˆ‘å€‘æ›´æ–°äº†å¾Œç«¯ä»£ç¢¼ä¸­ä½¿ç”¨çš„ Mongoose æ–¹æ³•ï¼Œå°‡è¼ƒèˆŠçš„æ–¹æ³•æ›¿æ›ç‚ºç¾ä»£çš„ç­‰æ•ˆæ–¹æ³•ã€‚

### 30.1 ä¸»è¦å•é¡Œåˆ†æèˆ‡è§£æ±º

**ç™¼ç¾çš„å•é¡Œ**ï¼š
- åˆªé™¤ä»»å‹™æ™‚å‡ºç¾ `task.remove is not a function` éŒ¯èª¤
- åˆªé™¤è¨ˆæ™‚è¨˜éŒ„æ™‚ä¹Ÿå¯èƒ½å‡ºç¾é¡ä¼¼éŒ¯èª¤
- åˆªé™¤å°ˆæ¡ˆæ™‚å¯èƒ½å‡ºç¾ç›¸åŒå•é¡Œ

**åŸå› **ï¼š
- Mongoose è¼ƒæ–°ç‰ˆæœ¬ä¸­å·²æ£„ç”¨æˆ–ç§»é™¤äº† `document.remove()` æ–¹æ³•
- ç¾ä»£ Mongoose æ¨è–¦ä½¿ç”¨ `Model.findByIdAndDelete()` æˆ– `Model.deleteOne()` æ–¹æ³•

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æ›´æ–°æ‰€æœ‰ä½¿ç”¨ `document.remove()` çš„ä»£ç¢¼ï¼Œæ”¹ç”¨ `Model.findByIdAndDelete()`
- å¢å¼·éŒ¯èª¤è™•ç†ï¼Œç•¶æ‰¾ä¸åˆ°è¦åˆªé™¤çš„æ–‡æª”æ™‚è¿”å›é©ç•¶çš„ç‹€æ…‹ç¢¼å’Œæ¶ˆæ¯
- ä¿æŒä»»å‹™çµ±è¨ˆæ•¸æ“šæ›´æ–°é‚è¼¯ä¸è®Š

### 30.2 ä¸»è¦ä¿®æ”¹æ–‡ä»¶æ¸…å–®

| æ–‡ä»¶ | ä¿®æ”¹å…§å®¹ | ç‹€æ…‹ |
|-----|---------|------|
| backend/routes/tasks.js | å°‡ `task.remove()` æ›¿æ›ç‚º `Task.findByIdAndDelete()` | âœ… å·²å®Œæˆ |
| backend/routes/timer.js | å°‡ `action.remove()` æ›¿æ›ç‚º `Action.findByIdAndDelete()` | âœ… å·²å®Œæˆ |
| backend/routes/projects.js | å°‡ `project.remove()` æ›¿æ›ç‚º `Project.findByIdAndDelete()` | âœ… å·²å®Œæˆ |

### 30.3 ä¿®æ”¹å‰å¾Œçš„ä»£ç¢¼æ¯”è¼ƒ

**èˆŠä»£ç¢¼ï¼ˆä½¿ç”¨ document.removeï¼‰**ï¼š
```javascript
const task = await Task.findById(taskId);
await task.remove();
```

**æ–°ä»£ç¢¼ï¼ˆä½¿ç”¨ Model.findByIdAndDeleteï¼‰**ï¼š
```javascript
const result = await Task.findByIdAndDelete(taskId);
if (!result) {
  return res.status(404).json({ message: 'æ‰¾ä¸åˆ°è©²ä»»å‹™' });
}
```

é€™ç¨®ç¾ä»£åŒ–æ›´æ–°ç¢ºä¿äº†æˆ‘å€‘çš„ä»£ç¢¼èˆ‡ç•¶å‰ç‰ˆæœ¬çš„ Mongoose å…¼å®¹ï¼Œä¸¦æé«˜äº†ä»£ç¢¼çš„ç©©å®šæ€§å’Œå¯é æ€§ã€‚

## ä¸‰åä¸€ã€ä»»å‹™-å°ˆæ¡ˆé—œè¯æ›´æ–°çš„ä¿®å¾©

åœ¨è™•ç†ä»»å‹™èˆ‡å°ˆæ¡ˆçš„é—œè¯æ™‚ï¼Œç™¼ç¾äº†ä¸€å€‹é—œéµå•é¡Œï¼Œè©²å•é¡Œå°è‡´ç³»çµ±é¡¯ç¤º "Task validation failed: name: Path 'name' is required" éŒ¯èª¤ã€‚

### 31.1 å•é¡Œåˆ†æèˆ‡è§£æ±º

**ç™¼ç¾çš„å•é¡Œ**ï¼š
- åœ¨æ›´æ–°ä»»å‹™-å°ˆæ¡ˆé—œè¯æ™‚ï¼Œç³»çµ±åªå‚³é€äº† `{ project: projectId }` çš„æ›´æ–°è³‡æ–™
- å¾Œç«¯çš„ Task æ¨¡å‹ä¸­ `name` æ¬„ä½æ˜¯å¿…å¡« (required)
- ä½¿ç”¨ `.save()` æ–¹æ³•åŸ·è¡Œæ›´æ–°æ™‚ï¼Œéœ€è¦é©—è­‰æ‰€æœ‰å¿…å¡«æ¬„ä½
- ç”±æ–¼æ²’æœ‰åŒ…å«ä»»å‹™åç¨±ï¼Œå¾Œç«¯é©—è­‰å¤±æ•—ä¸¦æ‹‹å‡ºéŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- åœ¨æ›´æ–°ä»»å‹™-å°ˆæ¡ˆé—œè¯æ™‚ï¼ŒåŒæ™‚æä¾›ä»»å‹™çš„åŸå§‹åç¨±
- ä¿®æ”¹ `handleTaskProjectChange` å‡½æ•¸ï¼Œå…ˆç²å–ç•¶å‰ä»»å‹™è³‡è¨Š
- æ›´æ–°æ™‚å‚³é€ `{ project: projectId, name: currentTask.name }` è³‡æ–™
- é€™ç¢ºä¿äº†åœ¨æ›´æ–°å°ˆæ¡ˆé—œè¯æ™‚ä¸æœƒä¸Ÿå¤±å¿…è¦çš„åç¨±æ¬„ä½

### 31.2 ç¨‹å¼ç¢¼ä¿®æ”¹

**åŸç¨‹å¼ç¢¼**ï¼š
```javascript
const handleTaskProjectChange = async (taskId, projectId) => {
  try {
    await updateTask(taskId, { project: projectId });
    // æ›´æ–°æœ¬åœ°ç‹€æ…‹
    setTasks(tasks.map(task => 
      task._id === taskId ? { ...task, project: projectId } : task
    ));
  } catch (err) {
    setError(err.message || 'æ›´æ–°ä»»å‹™é—œè¯å¤±æ•—');
  }
};
```

**ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼**ï¼š
```javascript
const handleTaskProjectChange = async (taskId, projectId) => {
  // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥
  if (!currentUser) {
    setError('è«‹å…ˆç™»å…¥');
    return;
  }
  
  try {
    // æ‰¾åˆ°ç•¶å‰ä»»å‹™è³‡è¨Š
    const currentTask = tasks.find(task => task._id === taskId);
    if (!currentTask) {
      throw new Error('æ‰¾ä¸åˆ°ä»»å‹™è³‡è¨Š');
    }
    
    // æ›´æ–°ä»»å‹™æ™‚ç¢ºä¿ä¿ç•™åŸæœ‰çš„ name æ¬„ä½
    await updateTask(taskId, { 
      project: projectId,
      name: currentTask.name // é‡è¦ï¼šä¿ç•™ä»»å‹™åç¨±ï¼Œé¿å… validation failed éŒ¯èª¤
    });
    
    // æ›´æ–°æœ¬åœ°ç‹€æ…‹
    setTasks(tasks.map(task => 